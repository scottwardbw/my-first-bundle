{"remainingRequest":"/Users/scott.ward/.npm/_npx/5239/lib/node_modules/@vizia/app-emulator/node_modules/babel-loader/lib/index.js??ref--4-1!/Users/scott.ward/Documents/GitHub/my-first-bundle/node_modules/readable-stream/lib/_stream_readable.js","dependencies":[{"path":"/Users/scott.ward/Documents/GitHub/my-first-bundle/node_modules/readable-stream/lib/_stream_readable.js","mtime":1629972623311},{"path":"/Users/scott.ward/.npm/_npx/5239/lib/node_modules/@vizia/app-emulator/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/scott.ward/.npm/_npx/5239/lib/node_modules/@vizia/app-emulator/node_modules/babel-loader/lib/index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8gQ29weXJpZ2h0IEpveWVudCwgSW5jLiBhbmQgb3RoZXIgTm9kZSBjb250cmlidXRvcnMuCi8vCi8vIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhCi8vIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUKLy8gIlNvZnR3YXJlIiksIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZwovLyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsCi8vIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQKLy8gcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlCi8vIGZvbGxvd2luZyBjb25kaXRpb25zOgovLwovLyBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZAovLyBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KLy8KLy8gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MKLy8gT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRgovLyBNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOCi8vIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLAovLyBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IKLy8gT1RIRVJXSVNFLCBBUklTSU5HIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRQovLyBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLgondXNlIHN0cmljdCc7Ci8qPHJlcGxhY2VtZW50PiovCgp2YXIgcG5hID0gcmVxdWlyZSgncHJvY2Vzcy1uZXh0aWNrLWFyZ3MnKTsKLyo8L3JlcGxhY2VtZW50PiovCgoKbW9kdWxlLmV4cG9ydHMgPSBSZWFkYWJsZTsKLyo8cmVwbGFjZW1lbnQ+Ki8KCnZhciBpc0FycmF5ID0gcmVxdWlyZSgnaXNhcnJheScpOwovKjwvcmVwbGFjZW1lbnQ+Ki8KCi8qPHJlcGxhY2VtZW50PiovCgoKdmFyIER1cGxleDsKLyo8L3JlcGxhY2VtZW50PiovCgpSZWFkYWJsZS5SZWFkYWJsZVN0YXRlID0gUmVhZGFibGVTdGF0ZTsKLyo8cmVwbGFjZW1lbnQ+Ki8KCnZhciBFRSA9IHJlcXVpcmUoJ2V2ZW50cycpLkV2ZW50RW1pdHRlcjsKCnZhciBFRWxpc3RlbmVyQ291bnQgPSBmdW5jdGlvbiAoZW1pdHRlciwgdHlwZSkgewogIHJldHVybiBlbWl0dGVyLmxpc3RlbmVycyh0eXBlKS5sZW5ndGg7Cn07Ci8qPC9yZXBsYWNlbWVudD4qLwoKLyo8cmVwbGFjZW1lbnQ+Ki8KCgp2YXIgU3RyZWFtID0gcmVxdWlyZSgnLi9pbnRlcm5hbC9zdHJlYW1zL3N0cmVhbScpOwovKjwvcmVwbGFjZW1lbnQ+Ki8KCi8qPHJlcGxhY2VtZW50PiovCgoKdmFyIEJ1ZmZlciA9IHJlcXVpcmUoJ3NhZmUtYnVmZmVyJykuQnVmZmVyOwoKdmFyIE91clVpbnQ4QXJyYXkgPSBnbG9iYWwuVWludDhBcnJheSB8fCBmdW5jdGlvbiAoKSB7fTsKCmZ1bmN0aW9uIF91aW50OEFycmF5VG9CdWZmZXIoY2h1bmspIHsKICByZXR1cm4gQnVmZmVyLmZyb20oY2h1bmspOwp9CgpmdW5jdGlvbiBfaXNVaW50OEFycmF5KG9iaikgewogIHJldHVybiBCdWZmZXIuaXNCdWZmZXIob2JqKSB8fCBvYmogaW5zdGFuY2VvZiBPdXJVaW50OEFycmF5Owp9Ci8qPC9yZXBsYWNlbWVudD4qLwoKLyo8cmVwbGFjZW1lbnQ+Ki8KCgp2YXIgdXRpbCA9IE9iamVjdC5jcmVhdGUocmVxdWlyZSgnY29yZS11dGlsLWlzJykpOwp1dGlsLmluaGVyaXRzID0gcmVxdWlyZSgnaW5oZXJpdHMnKTsKLyo8L3JlcGxhY2VtZW50PiovCgovKjxyZXBsYWNlbWVudD4qLwoKdmFyIGRlYnVnVXRpbCA9IHJlcXVpcmUoJ3V0aWwnKTsKCnZhciBkZWJ1ZyA9IHZvaWQgMDsKCmlmIChkZWJ1Z1V0aWwgJiYgZGVidWdVdGlsLmRlYnVnbG9nKSB7CiAgZGVidWcgPSBkZWJ1Z1V0aWwuZGVidWdsb2coJ3N0cmVhbScpOwp9IGVsc2UgewogIGRlYnVnID0gZnVuY3Rpb24gKCkge307Cn0KLyo8L3JlcGxhY2VtZW50PiovCgoKdmFyIEJ1ZmZlckxpc3QgPSByZXF1aXJlKCcuL2ludGVybmFsL3N0cmVhbXMvQnVmZmVyTGlzdCcpOwoKdmFyIGRlc3Ryb3lJbXBsID0gcmVxdWlyZSgnLi9pbnRlcm5hbC9zdHJlYW1zL2Rlc3Ryb3knKTsKCnZhciBTdHJpbmdEZWNvZGVyOwp1dGlsLmluaGVyaXRzKFJlYWRhYmxlLCBTdHJlYW0pOwp2YXIga1Byb3h5RXZlbnRzID0gWydlcnJvcicsICdjbG9zZScsICdkZXN0cm95JywgJ3BhdXNlJywgJ3Jlc3VtZSddOwoKZnVuY3Rpb24gcHJlcGVuZExpc3RlbmVyKGVtaXR0ZXIsIGV2ZW50LCBmbikgewogIC8vIFNhZGx5IHRoaXMgaXMgbm90IGNhY2hlYWJsZSBhcyBzb21lIGxpYnJhcmllcyBidW5kbGUgdGhlaXIgb3duCiAgLy8gZXZlbnQgZW1pdHRlciBpbXBsZW1lbnRhdGlvbiB3aXRoIHRoZW0uCiAgaWYgKHR5cGVvZiBlbWl0dGVyLnByZXBlbmRMaXN0ZW5lciA9PT0gJ2Z1bmN0aW9uJykgcmV0dXJuIGVtaXR0ZXIucHJlcGVuZExpc3RlbmVyKGV2ZW50LCBmbik7IC8vIFRoaXMgaXMgYSBoYWNrIHRvIG1ha2Ugc3VyZSB0aGF0IG91ciBlcnJvciBoYW5kbGVyIGlzIGF0dGFjaGVkIGJlZm9yZSBhbnkKICAvLyB1c2VybGFuZCBvbmVzLiAgTkVWRVIgRE8gVEhJUy4gVGhpcyBpcyBoZXJlIG9ubHkgYmVjYXVzZSB0aGlzIGNvZGUgbmVlZHMKICAvLyB0byBjb250aW51ZSB0byB3b3JrIHdpdGggb2xkZXIgdmVyc2lvbnMgb2YgTm9kZS5qcyB0aGF0IGRvIG5vdCBpbmNsdWRlCiAgLy8gdGhlIHByZXBlbmRMaXN0ZW5lcigpIG1ldGhvZC4gVGhlIGdvYWwgaXMgdG8gZXZlbnR1YWxseSByZW1vdmUgdGhpcyBoYWNrLgoKICBpZiAoIWVtaXR0ZXIuX2V2ZW50cyB8fCAhZW1pdHRlci5fZXZlbnRzW2V2ZW50XSkgZW1pdHRlci5vbihldmVudCwgZm4pO2Vsc2UgaWYgKGlzQXJyYXkoZW1pdHRlci5fZXZlbnRzW2V2ZW50XSkpIGVtaXR0ZXIuX2V2ZW50c1tldmVudF0udW5zaGlmdChmbik7ZWxzZSBlbWl0dGVyLl9ldmVudHNbZXZlbnRdID0gW2ZuLCBlbWl0dGVyLl9ldmVudHNbZXZlbnRdXTsKfQoKZnVuY3Rpb24gUmVhZGFibGVTdGF0ZShvcHRpb25zLCBzdHJlYW0pIHsKICBEdXBsZXggPSBEdXBsZXggfHwgcmVxdWlyZSgnLi9fc3RyZWFtX2R1cGxleCcpOwogIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OyAvLyBEdXBsZXggc3RyZWFtcyBhcmUgYm90aCByZWFkYWJsZSBhbmQgd3JpdGFibGUsIGJ1dCBzaGFyZQogIC8vIHRoZSBzYW1lIG9wdGlvbnMgb2JqZWN0LgogIC8vIEhvd2V2ZXIsIHNvbWUgY2FzZXMgcmVxdWlyZSBzZXR0aW5nIG9wdGlvbnMgdG8gZGlmZmVyZW50CiAgLy8gdmFsdWVzIGZvciB0aGUgcmVhZGFibGUgYW5kIHRoZSB3cml0YWJsZSBzaWRlcyBvZiB0aGUgZHVwbGV4IHN0cmVhbS4KICAvLyBUaGVzZSBvcHRpb25zIGNhbiBiZSBwcm92aWRlZCBzZXBhcmF0ZWx5IGFzIHJlYWRhYmxlWFhYIGFuZCB3cml0YWJsZVhYWC4KCiAgdmFyIGlzRHVwbGV4ID0gc3RyZWFtIGluc3RhbmNlb2YgRHVwbGV4OyAvLyBvYmplY3Qgc3RyZWFtIGZsYWcuIFVzZWQgdG8gbWFrZSByZWFkKG4pIGlnbm9yZSBuIGFuZCB0bwogIC8vIG1ha2UgYWxsIHRoZSBidWZmZXIgbWVyZ2luZyBhbmQgbGVuZ3RoIGNoZWNrcyBnbyBhd2F5CgogIHRoaXMub2JqZWN0TW9kZSA9ICEhb3B0aW9ucy5vYmplY3RNb2RlOwogIGlmIChpc0R1cGxleCkgdGhpcy5vYmplY3RNb2RlID0gdGhpcy5vYmplY3RNb2RlIHx8ICEhb3B0aW9ucy5yZWFkYWJsZU9iamVjdE1vZGU7IC8vIHRoZSBwb2ludCBhdCB3aGljaCBpdCBzdG9wcyBjYWxsaW5nIF9yZWFkKCkgdG8gZmlsbCB0aGUgYnVmZmVyCiAgLy8gTm90ZTogMCBpcyBhIHZhbGlkIHZhbHVlLCBtZWFucyAiZG9uJ3QgY2FsbCBfcmVhZCBwcmVlbXB0aXZlbHkgZXZlciIKCiAgdmFyIGh3bSA9IG9wdGlvbnMuaGlnaFdhdGVyTWFyazsKICB2YXIgcmVhZGFibGVId20gPSBvcHRpb25zLnJlYWRhYmxlSGlnaFdhdGVyTWFyazsKICB2YXIgZGVmYXVsdEh3bSA9IHRoaXMub2JqZWN0TW9kZSA/IDE2IDogMTYgKiAxMDI0OwogIGlmIChod20gfHwgaHdtID09PSAwKSB0aGlzLmhpZ2hXYXRlck1hcmsgPSBod207ZWxzZSBpZiAoaXNEdXBsZXggJiYgKHJlYWRhYmxlSHdtIHx8IHJlYWRhYmxlSHdtID09PSAwKSkgdGhpcy5oaWdoV2F0ZXJNYXJrID0gcmVhZGFibGVId207ZWxzZSB0aGlzLmhpZ2hXYXRlck1hcmsgPSBkZWZhdWx0SHdtOyAvLyBjYXN0IHRvIGludHMuCgogIHRoaXMuaGlnaFdhdGVyTWFyayA9IE1hdGguZmxvb3IodGhpcy5oaWdoV2F0ZXJNYXJrKTsgLy8gQSBsaW5rZWQgbGlzdCBpcyB1c2VkIHRvIHN0b3JlIGRhdGEgY2h1bmtzIGluc3RlYWQgb2YgYW4gYXJyYXkgYmVjYXVzZSB0aGUKICAvLyBsaW5rZWQgbGlzdCBjYW4gcmVtb3ZlIGVsZW1lbnRzIGZyb20gdGhlIGJlZ2lubmluZyBmYXN0ZXIgdGhhbgogIC8vIGFycmF5LnNoaWZ0KCkKCiAgdGhpcy5idWZmZXIgPSBuZXcgQnVmZmVyTGlzdCgpOwogIHRoaXMubGVuZ3RoID0gMDsKICB0aGlzLnBpcGVzID0gbnVsbDsKICB0aGlzLnBpcGVzQ291bnQgPSAwOwogIHRoaXMuZmxvd2luZyA9IG51bGw7CiAgdGhpcy5lbmRlZCA9IGZhbHNlOwogIHRoaXMuZW5kRW1pdHRlZCA9IGZhbHNlOwogIHRoaXMucmVhZGluZyA9IGZhbHNlOyAvLyBhIGZsYWcgdG8gYmUgYWJsZSB0byB0ZWxsIGlmIHRoZSBldmVudCAncmVhZGFibGUnLydkYXRhJyBpcyBlbWl0dGVkCiAgLy8gaW1tZWRpYXRlbHksIG9yIG9uIGEgbGF0ZXIgdGljay4gIFdlIHNldCB0aGlzIHRvIHRydWUgYXQgZmlyc3QsIGJlY2F1c2UKICAvLyBhbnkgYWN0aW9ucyB0aGF0IHNob3VsZG4ndCBoYXBwZW4gdW50aWwgImxhdGVyIiBzaG91bGQgZ2VuZXJhbGx5IGFsc28KICAvLyBub3QgaGFwcGVuIGJlZm9yZSB0aGUgZmlyc3QgcmVhZCBjYWxsLgoKICB0aGlzLnN5bmMgPSB0cnVlOyAvLyB3aGVuZXZlciB3ZSByZXR1cm4gbnVsbCwgdGhlbiB3ZSBzZXQgYSBmbGFnIHRvIHNheQogIC8vIHRoYXQgd2UncmUgYXdhaXRpbmcgYSAncmVhZGFibGUnIGV2ZW50IGVtaXNzaW9uLgoKICB0aGlzLm5lZWRSZWFkYWJsZSA9IGZhbHNlOwogIHRoaXMuZW1pdHRlZFJlYWRhYmxlID0gZmFsc2U7CiAgdGhpcy5yZWFkYWJsZUxpc3RlbmluZyA9IGZhbHNlOwogIHRoaXMucmVzdW1lU2NoZWR1bGVkID0gZmFsc2U7IC8vIGhhcyBpdCBiZWVuIGRlc3Ryb3llZAoKICB0aGlzLmRlc3Ryb3llZCA9IGZhbHNlOyAvLyBDcnlwdG8gaXMga2luZCBvZiBvbGQgYW5kIGNydXN0eS4gIEhpc3RvcmljYWxseSwgaXRzIGRlZmF1bHQgc3RyaW5nCiAgLy8gZW5jb2RpbmcgaXMgJ2JpbmFyeScgc28gd2UgaGF2ZSB0byBtYWtlIHRoaXMgY29uZmlndXJhYmxlLgogIC8vIEV2ZXJ5dGhpbmcgZWxzZSBpbiB0aGUgdW5pdmVyc2UgdXNlcyAndXRmOCcsIHRob3VnaC4KCiAgdGhpcy5kZWZhdWx0RW5jb2RpbmcgPSBvcHRpb25zLmRlZmF1bHRFbmNvZGluZyB8fCAndXRmOCc7IC8vIHRoZSBudW1iZXIgb2Ygd3JpdGVycyB0aGF0IGFyZSBhd2FpdGluZyBhIGRyYWluIGV2ZW50IGluIC5waXBlKClzCgogIHRoaXMuYXdhaXREcmFpbiA9IDA7IC8vIGlmIHRydWUsIGEgbWF5YmVSZWFkTW9yZSBoYXMgYmVlbiBzY2hlZHVsZWQKCiAgdGhpcy5yZWFkaW5nTW9yZSA9IGZhbHNlOwogIHRoaXMuZGVjb2RlciA9IG51bGw7CiAgdGhpcy5lbmNvZGluZyA9IG51bGw7CgogIGlmIChvcHRpb25zLmVuY29kaW5nKSB7CiAgICBpZiAoIVN0cmluZ0RlY29kZXIpIFN0cmluZ0RlY29kZXIgPSByZXF1aXJlKCdzdHJpbmdfZGVjb2Rlci8nKS5TdHJpbmdEZWNvZGVyOwogICAgdGhpcy5kZWNvZGVyID0gbmV3IFN0cmluZ0RlY29kZXIob3B0aW9ucy5lbmNvZGluZyk7CiAgICB0aGlzLmVuY29kaW5nID0gb3B0aW9ucy5lbmNvZGluZzsKICB9Cn0KCmZ1bmN0aW9uIFJlYWRhYmxlKG9wdGlvbnMpIHsKICBEdXBsZXggPSBEdXBsZXggfHwgcmVxdWlyZSgnLi9fc3RyZWFtX2R1cGxleCcpOwogIGlmICghKHRoaXMgaW5zdGFuY2VvZiBSZWFkYWJsZSkpIHJldHVybiBuZXcgUmVhZGFibGUob3B0aW9ucyk7CiAgdGhpcy5fcmVhZGFibGVTdGF0ZSA9IG5ldyBSZWFkYWJsZVN0YXRlKG9wdGlvbnMsIHRoaXMpOyAvLyBsZWdhY3kKCiAgdGhpcy5yZWFkYWJsZSA9IHRydWU7CgogIGlmIChvcHRpb25zKSB7CiAgICBpZiAodHlwZW9mIG9wdGlvbnMucmVhZCA9PT0gJ2Z1bmN0aW9uJykgdGhpcy5fcmVhZCA9IG9wdGlvbnMucmVhZDsKICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5kZXN0cm95ID09PSAnZnVuY3Rpb24nKSB0aGlzLl9kZXN0cm95ID0gb3B0aW9ucy5kZXN0cm95OwogIH0KCiAgU3RyZWFtLmNhbGwodGhpcyk7Cn0KCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZWFkYWJsZS5wcm90b3R5cGUsICdkZXN0cm95ZWQnLCB7CiAgZ2V0OiBmdW5jdGlvbiAoKSB7CiAgICBpZiAodGhpcy5fcmVhZGFibGVTdGF0ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICByZXR1cm4gdGhpcy5fcmVhZGFibGVTdGF0ZS5kZXN0cm95ZWQ7CiAgfSwKICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkgewogICAgLy8gd2UgaWdub3JlIHRoZSB2YWx1ZSBpZiB0aGUgc3RyZWFtCiAgICAvLyBoYXMgbm90IGJlZW4gaW5pdGlhbGl6ZWQgeWV0CiAgICBpZiAoIXRoaXMuX3JlYWRhYmxlU3RhdGUpIHsKICAgICAgcmV0dXJuOwogICAgfSAvLyBiYWNrd2FyZCBjb21wYXRpYmlsaXR5LCB0aGUgdXNlciBpcyBleHBsaWNpdGx5CiAgICAvLyBtYW5hZ2luZyBkZXN0cm95ZWQKCgogICAgdGhpcy5fcmVhZGFibGVTdGF0ZS5kZXN0cm95ZWQgPSB2YWx1ZTsKICB9Cn0pOwpSZWFkYWJsZS5wcm90b3R5cGUuZGVzdHJveSA9IGRlc3Ryb3lJbXBsLmRlc3Ryb3k7ClJlYWRhYmxlLnByb3RvdHlwZS5fdW5kZXN0cm95ID0gZGVzdHJveUltcGwudW5kZXN0cm95OwoKUmVhZGFibGUucHJvdG90eXBlLl9kZXN0cm95ID0gZnVuY3Rpb24gKGVyciwgY2IpIHsKICB0aGlzLnB1c2gobnVsbCk7CiAgY2IoZXJyKTsKfTsgLy8gTWFudWFsbHkgc2hvdmUgc29tZXRoaW5nIGludG8gdGhlIHJlYWQoKSBidWZmZXIuCi8vIFRoaXMgcmV0dXJucyB0cnVlIGlmIHRoZSBoaWdoV2F0ZXJNYXJrIGhhcyBub3QgYmVlbiBoaXQgeWV0LAovLyBzaW1pbGFyIHRvIGhvdyBXcml0YWJsZS53cml0ZSgpIHJldHVybnMgdHJ1ZSBpZiB5b3Ugc2hvdWxkCi8vIHdyaXRlKCkgc29tZSBtb3JlLgoKClJlYWRhYmxlLnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24gKGNodW5rLCBlbmNvZGluZykgewogIHZhciBzdGF0ZSA9IHRoaXMuX3JlYWRhYmxlU3RhdGU7CiAgdmFyIHNraXBDaHVua0NoZWNrOwoKICBpZiAoIXN0YXRlLm9iamVjdE1vZGUpIHsKICAgIGlmICh0eXBlb2YgY2h1bmsgPT09ICdzdHJpbmcnKSB7CiAgICAgIGVuY29kaW5nID0gZW5jb2RpbmcgfHwgc3RhdGUuZGVmYXVsdEVuY29kaW5nOwoKICAgICAgaWYgKGVuY29kaW5nICE9PSBzdGF0ZS5lbmNvZGluZykgewogICAgICAgIGNodW5rID0gQnVmZmVyLmZyb20oY2h1bmssIGVuY29kaW5nKTsKICAgICAgICBlbmNvZGluZyA9ICcnOwogICAgICB9CgogICAgICBza2lwQ2h1bmtDaGVjayA9IHRydWU7CiAgICB9CiAgfSBlbHNlIHsKICAgIHNraXBDaHVua0NoZWNrID0gdHJ1ZTsKICB9CgogIHJldHVybiByZWFkYWJsZUFkZENodW5rKHRoaXMsIGNodW5rLCBlbmNvZGluZywgZmFsc2UsIHNraXBDaHVua0NoZWNrKTsKfTsgLy8gVW5zaGlmdCBzaG91bGQgKmFsd2F5cyogYmUgc29tZXRoaW5nIGRpcmVjdGx5IG91dCBvZiByZWFkKCkKCgpSZWFkYWJsZS5wcm90b3R5cGUudW5zaGlmdCA9IGZ1bmN0aW9uIChjaHVuaykgewogIHJldHVybiByZWFkYWJsZUFkZENodW5rKHRoaXMsIGNodW5rLCBudWxsLCB0cnVlLCBmYWxzZSk7Cn07CgpmdW5jdGlvbiByZWFkYWJsZUFkZENodW5rKHN0cmVhbSwgY2h1bmssIGVuY29kaW5nLCBhZGRUb0Zyb250LCBza2lwQ2h1bmtDaGVjaykgewogIHZhciBzdGF0ZSA9IHN0cmVhbS5fcmVhZGFibGVTdGF0ZTsKCiAgaWYgKGNodW5rID09PSBudWxsKSB7CiAgICBzdGF0ZS5yZWFkaW5nID0gZmFsc2U7CiAgICBvbkVvZkNodW5rKHN0cmVhbSwgc3RhdGUpOwogIH0gZWxzZSB7CiAgICB2YXIgZXI7CiAgICBpZiAoIXNraXBDaHVua0NoZWNrKSBlciA9IGNodW5rSW52YWxpZChzdGF0ZSwgY2h1bmspOwoKICAgIGlmIChlcikgewogICAgICBzdHJlYW0uZW1pdCgnZXJyb3InLCBlcik7CiAgICB9IGVsc2UgaWYgKHN0YXRlLm9iamVjdE1vZGUgfHwgY2h1bmsgJiYgY2h1bmsubGVuZ3RoID4gMCkgewogICAgICBpZiAodHlwZW9mIGNodW5rICE9PSAnc3RyaW5nJyAmJiAhc3RhdGUub2JqZWN0TW9kZSAmJiBPYmplY3QuZ2V0UHJvdG90eXBlT2YoY2h1bmspICE9PSBCdWZmZXIucHJvdG90eXBlKSB7CiAgICAgICAgY2h1bmsgPSBfdWludDhBcnJheVRvQnVmZmVyKGNodW5rKTsKICAgICAgfQoKICAgICAgaWYgKGFkZFRvRnJvbnQpIHsKICAgICAgICBpZiAoc3RhdGUuZW5kRW1pdHRlZCkgc3RyZWFtLmVtaXQoJ2Vycm9yJywgbmV3IEVycm9yKCdzdHJlYW0udW5zaGlmdCgpIGFmdGVyIGVuZCBldmVudCcpKTtlbHNlIGFkZENodW5rKHN0cmVhbSwgc3RhdGUsIGNodW5rLCB0cnVlKTsKICAgICAgfSBlbHNlIGlmIChzdGF0ZS5lbmRlZCkgewogICAgICAgIHN0cmVhbS5lbWl0KCdlcnJvcicsIG5ldyBFcnJvcignc3RyZWFtLnB1c2goKSBhZnRlciBFT0YnKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc3RhdGUucmVhZGluZyA9IGZhbHNlOwoKICAgICAgICBpZiAoc3RhdGUuZGVjb2RlciAmJiAhZW5jb2RpbmcpIHsKICAgICAgICAgIGNodW5rID0gc3RhdGUuZGVjb2Rlci53cml0ZShjaHVuayk7CiAgICAgICAgICBpZiAoc3RhdGUub2JqZWN0TW9kZSB8fCBjaHVuay5sZW5ndGggIT09IDApIGFkZENodW5rKHN0cmVhbSwgc3RhdGUsIGNodW5rLCBmYWxzZSk7ZWxzZSBtYXliZVJlYWRNb3JlKHN0cmVhbSwgc3RhdGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhZGRDaHVuayhzdHJlYW0sIHN0YXRlLCBjaHVuaywgZmFsc2UpOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIGlmICghYWRkVG9Gcm9udCkgewogICAgICBzdGF0ZS5yZWFkaW5nID0gZmFsc2U7CiAgICB9CiAgfQoKICByZXR1cm4gbmVlZE1vcmVEYXRhKHN0YXRlKTsKfQoKZnVuY3Rpb24gYWRkQ2h1bmsoc3RyZWFtLCBzdGF0ZSwgY2h1bmssIGFkZFRvRnJvbnQpIHsKICBpZiAoc3RhdGUuZmxvd2luZyAmJiBzdGF0ZS5sZW5ndGggPT09IDAgJiYgIXN0YXRlLnN5bmMpIHsKICAgIHN0cmVhbS5lbWl0KCdkYXRhJywgY2h1bmspOwogICAgc3RyZWFtLnJlYWQoMCk7CiAgfSBlbHNlIHsKICAgIC8vIHVwZGF0ZSB0aGUgYnVmZmVyIGluZm8uCiAgICBzdGF0ZS5sZW5ndGggKz0gc3RhdGUub2JqZWN0TW9kZSA/IDEgOiBjaHVuay5sZW5ndGg7CiAgICBpZiAoYWRkVG9Gcm9udCkgc3RhdGUuYnVmZmVyLnVuc2hpZnQoY2h1bmspO2Vsc2Ugc3RhdGUuYnVmZmVyLnB1c2goY2h1bmspOwogICAgaWYgKHN0YXRlLm5lZWRSZWFkYWJsZSkgZW1pdFJlYWRhYmxlKHN0cmVhbSk7CiAgfQoKICBtYXliZVJlYWRNb3JlKHN0cmVhbSwgc3RhdGUpOwp9CgpmdW5jdGlvbiBjaHVua0ludmFsaWQoc3RhdGUsIGNodW5rKSB7CiAgdmFyIGVyOwoKICBpZiAoIV9pc1VpbnQ4QXJyYXkoY2h1bmspICYmIHR5cGVvZiBjaHVuayAhPT0gJ3N0cmluZycgJiYgY2h1bmsgIT09IHVuZGVmaW5lZCAmJiAhc3RhdGUub2JqZWN0TW9kZSkgewogICAgZXIgPSBuZXcgVHlwZUVycm9yKCdJbnZhbGlkIG5vbi1zdHJpbmcvYnVmZmVyIGNodW5rJyk7CiAgfQoKICByZXR1cm4gZXI7Cn0gLy8gaWYgaXQncyBwYXN0IHRoZSBoaWdoIHdhdGVyIG1hcmssIHdlIGNhbiBwdXNoIGluIHNvbWUgbW9yZS4KLy8gQWxzbywgaWYgd2UgaGF2ZSBubyBkYXRhIHlldCwgd2UgY2FuIHN0YW5kIHNvbWUKLy8gbW9yZSBieXRlcy4gIFRoaXMgaXMgdG8gd29yayBhcm91bmQgY2FzZXMgd2hlcmUgaHdtPTAsCi8vIHN1Y2ggYXMgdGhlIHJlcGwuICBBbHNvLCBpZiB0aGUgcHVzaCgpIHRyaWdnZXJlZCBhCi8vIHJlYWRhYmxlIGV2ZW50LCBhbmQgdGhlIHVzZXIgY2FsbGVkIHJlYWQobGFyZ2VOdW1iZXIpIHN1Y2ggdGhhdAovLyBuZWVkUmVhZGFibGUgd2FzIHNldCwgdGhlbiB3ZSBvdWdodCB0byBwdXNoIG1vcmUsIHNvIHRoYXQgYW5vdGhlcgovLyAncmVhZGFibGUnIGV2ZW50IHdpbGwgYmUgdHJpZ2dlcmVkLgoKCmZ1bmN0aW9uIG5lZWRNb3JlRGF0YShzdGF0ZSkgewogIHJldHVybiAhc3RhdGUuZW5kZWQgJiYgKHN0YXRlLm5lZWRSZWFkYWJsZSB8fCBzdGF0ZS5sZW5ndGggPCBzdGF0ZS5oaWdoV2F0ZXJNYXJrIHx8IHN0YXRlLmxlbmd0aCA9PT0gMCk7Cn0KClJlYWRhYmxlLnByb3RvdHlwZS5pc1BhdXNlZCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gdGhpcy5fcmVhZGFibGVTdGF0ZS5mbG93aW5nID09PSBmYWxzZTsKfTsgLy8gYmFja3dhcmRzIGNvbXBhdGliaWxpdHkuCgoKUmVhZGFibGUucHJvdG90eXBlLnNldEVuY29kaW5nID0gZnVuY3Rpb24gKGVuYykgewogIGlmICghU3RyaW5nRGVjb2RlcikgU3RyaW5nRGVjb2RlciA9IHJlcXVpcmUoJ3N0cmluZ19kZWNvZGVyLycpLlN0cmluZ0RlY29kZXI7CiAgdGhpcy5fcmVhZGFibGVTdGF0ZS5kZWNvZGVyID0gbmV3IFN0cmluZ0RlY29kZXIoZW5jKTsKICB0aGlzLl9yZWFkYWJsZVN0YXRlLmVuY29kaW5nID0gZW5jOwogIHJldHVybiB0aGlzOwp9OyAvLyBEb24ndCByYWlzZSB0aGUgaHdtID4gOE1CCgoKdmFyIE1BWF9IV00gPSAweDgwMDAwMDsKCmZ1bmN0aW9uIGNvbXB1dGVOZXdIaWdoV2F0ZXJNYXJrKG4pIHsKICBpZiAobiA+PSBNQVhfSFdNKSB7CiAgICBuID0gTUFYX0hXTTsKICB9IGVsc2UgewogICAgLy8gR2V0IHRoZSBuZXh0IGhpZ2hlc3QgcG93ZXIgb2YgMiB0byBwcmV2ZW50IGluY3JlYXNpbmcgaHdtIGV4Y2Vzc2l2ZWx5IGluCiAgICAvLyB0aW55IGFtb3VudHMKICAgIG4tLTsKICAgIG4gfD0gbiA+Pj4gMTsKICAgIG4gfD0gbiA+Pj4gMjsKICAgIG4gfD0gbiA+Pj4gNDsKICAgIG4gfD0gbiA+Pj4gODsKICAgIG4gfD0gbiA+Pj4gMTY7CiAgICBuKys7CiAgfQoKICByZXR1cm4gbjsKfSAvLyBUaGlzIGZ1bmN0aW9uIGlzIGRlc2lnbmVkIHRvIGJlIGlubGluYWJsZSwgc28gcGxlYXNlIHRha2UgY2FyZSB3aGVuIG1ha2luZwovLyBjaGFuZ2VzIHRvIHRoZSBmdW5jdGlvbiBib2R5LgoKCmZ1bmN0aW9uIGhvd011Y2hUb1JlYWQobiwgc3RhdGUpIHsKICBpZiAobiA8PSAwIHx8IHN0YXRlLmxlbmd0aCA9PT0gMCAmJiBzdGF0ZS5lbmRlZCkgcmV0dXJuIDA7CiAgaWYgKHN0YXRlLm9iamVjdE1vZGUpIHJldHVybiAxOwoKICBpZiAobiAhPT0gbikgewogICAgLy8gT25seSBmbG93IG9uZSBidWZmZXIgYXQgYSB0aW1lCiAgICBpZiAoc3RhdGUuZmxvd2luZyAmJiBzdGF0ZS5sZW5ndGgpIHJldHVybiBzdGF0ZS5idWZmZXIuaGVhZC5kYXRhLmxlbmd0aDtlbHNlIHJldHVybiBzdGF0ZS5sZW5ndGg7CiAgfSAvLyBJZiB3ZSdyZSBhc2tpbmcgZm9yIG1vcmUgdGhhbiB0aGUgY3VycmVudCBod20sIHRoZW4gcmFpc2UgdGhlIGh3bS4KCgogIGlmIChuID4gc3RhdGUuaGlnaFdhdGVyTWFyaykgc3RhdGUuaGlnaFdhdGVyTWFyayA9IGNvbXB1dGVOZXdIaWdoV2F0ZXJNYXJrKG4pOwogIGlmIChuIDw9IHN0YXRlLmxlbmd0aCkgcmV0dXJuIG47IC8vIERvbid0IGhhdmUgZW5vdWdoCgogIGlmICghc3RhdGUuZW5kZWQpIHsKICAgIHN0YXRlLm5lZWRSZWFkYWJsZSA9IHRydWU7CiAgICByZXR1cm4gMDsKICB9CgogIHJldHVybiBzdGF0ZS5sZW5ndGg7Cn0gLy8geW91IGNhbiBvdmVycmlkZSBlaXRoZXIgdGhpcyBtZXRob2QsIG9yIHRoZSBhc3luYyBfcmVhZChuKSBiZWxvdy4KCgpSZWFkYWJsZS5wcm90b3R5cGUucmVhZCA9IGZ1bmN0aW9uIChuKSB7CiAgZGVidWcoJ3JlYWQnLCBuKTsKICBuID0gcGFyc2VJbnQobiwgMTApOwogIHZhciBzdGF0ZSA9IHRoaXMuX3JlYWRhYmxlU3RhdGU7CiAgdmFyIG5PcmlnID0gbjsKICBpZiAobiAhPT0gMCkgc3RhdGUuZW1pdHRlZFJlYWRhYmxlID0gZmFsc2U7IC8vIGlmIHdlJ3JlIGRvaW5nIHJlYWQoMCkgdG8gdHJpZ2dlciBhIHJlYWRhYmxlIGV2ZW50LCBidXQgd2UKICAvLyBhbHJlYWR5IGhhdmUgYSBidW5jaCBvZiBkYXRhIGluIHRoZSBidWZmZXIsIHRoZW4ganVzdCB0cmlnZ2VyCiAgLy8gdGhlICdyZWFkYWJsZScgZXZlbnQgYW5kIG1vdmUgb24uCgogIGlmIChuID09PSAwICYmIHN0YXRlLm5lZWRSZWFkYWJsZSAmJiAoc3RhdGUubGVuZ3RoID49IHN0YXRlLmhpZ2hXYXRlck1hcmsgfHwgc3RhdGUuZW5kZWQpKSB7CiAgICBkZWJ1ZygncmVhZDogZW1pdFJlYWRhYmxlJywgc3RhdGUubGVuZ3RoLCBzdGF0ZS5lbmRlZCk7CiAgICBpZiAoc3RhdGUubGVuZ3RoID09PSAwICYmIHN0YXRlLmVuZGVkKSBlbmRSZWFkYWJsZSh0aGlzKTtlbHNlIGVtaXRSZWFkYWJsZSh0aGlzKTsKICAgIHJldHVybiBudWxsOwogIH0KCiAgbiA9IGhvd011Y2hUb1JlYWQobiwgc3RhdGUpOyAvLyBpZiB3ZSd2ZSBlbmRlZCwgYW5kIHdlJ3JlIG5vdyBjbGVhciwgdGhlbiBmaW5pc2ggaXQgdXAuCgogIGlmIChuID09PSAwICYmIHN0YXRlLmVuZGVkKSB7CiAgICBpZiAoc3RhdGUubGVuZ3RoID09PSAwKSBlbmRSZWFkYWJsZSh0aGlzKTsKICAgIHJldHVybiBudWxsOwogIH0gLy8gQWxsIHRoZSBhY3R1YWwgY2h1bmsgZ2VuZXJhdGlvbiBsb2dpYyBuZWVkcyB0byBiZQogIC8vICpiZWxvdyogdGhlIGNhbGwgdG8gX3JlYWQuICBUaGUgcmVhc29uIGlzIHRoYXQgaW4gY2VydGFpbgogIC8vIHN5bnRoZXRpYyBzdHJlYW0gY2FzZXMsIHN1Y2ggYXMgcGFzc3Rocm91Z2ggc3RyZWFtcywgX3JlYWQKICAvLyBtYXkgYmUgYSBjb21wbGV0ZWx5IHN5bmNocm9ub3VzIG9wZXJhdGlvbiB3aGljaCBtYXkgY2hhbmdlCiAgLy8gdGhlIHN0YXRlIG9mIHRoZSByZWFkIGJ1ZmZlciwgcHJvdmlkaW5nIGVub3VnaCBkYXRhIHdoZW4KICAvLyBiZWZvcmUgdGhlcmUgd2FzICpub3QqIGVub3VnaC4KICAvLwogIC8vIFNvLCB0aGUgc3RlcHMgYXJlOgogIC8vIDEuIEZpZ3VyZSBvdXQgd2hhdCB0aGUgc3RhdGUgb2YgdGhpbmdzIHdpbGwgYmUgYWZ0ZXIgd2UgZG8KICAvLyBhIHJlYWQgZnJvbSB0aGUgYnVmZmVyLgogIC8vCiAgLy8gMi4gSWYgdGhhdCByZXN1bHRpbmcgc3RhdGUgd2lsbCB0cmlnZ2VyIGEgX3JlYWQsIHRoZW4gY2FsbCBfcmVhZC4KICAvLyBOb3RlIHRoYXQgdGhpcyBtYXkgYmUgYXN5bmNocm9ub3VzLCBvciBzeW5jaHJvbm91cy4gIFllcywgaXQgaXMKICAvLyBkZWVwbHkgdWdseSB0byB3cml0ZSBBUElzIHRoaXMgd2F5LCBidXQgdGhhdCBzdGlsbCBkb2Vzbid0IG1lYW4KICAvLyB0aGF0IHRoZSBSZWFkYWJsZSBjbGFzcyBzaG91bGQgYmVoYXZlIGltcHJvcGVybHksIGFzIHN0cmVhbXMgYXJlCiAgLy8gZGVzaWduZWQgdG8gYmUgc3luYy9hc3luYyBhZ25vc3RpYy4KICAvLyBUYWtlIG5vdGUgaWYgdGhlIF9yZWFkIGNhbGwgaXMgc3luYyBvciBhc3luYyAoaWUsIGlmIHRoZSByZWFkIGNhbGwKICAvLyBoYXMgcmV0dXJuZWQgeWV0KSwgc28gdGhhdCB3ZSBrbm93IHdoZXRoZXIgb3Igbm90IGl0J3Mgc2FmZSB0byBlbWl0CiAgLy8gJ3JlYWRhYmxlJyBldGMuCiAgLy8KICAvLyAzLiBBY3R1YWxseSBwdWxsIHRoZSByZXF1ZXN0ZWQgY2h1bmtzIG91dCBvZiB0aGUgYnVmZmVyIGFuZCByZXR1cm4uCiAgLy8gaWYgd2UgbmVlZCBhIHJlYWRhYmxlIGV2ZW50LCB0aGVuIHdlIG5lZWQgdG8gZG8gc29tZSByZWFkaW5nLgoKCiAgdmFyIGRvUmVhZCA9IHN0YXRlLm5lZWRSZWFkYWJsZTsKICBkZWJ1ZygnbmVlZCByZWFkYWJsZScsIGRvUmVhZCk7IC8vIGlmIHdlIGN1cnJlbnRseSBoYXZlIGxlc3MgdGhhbiB0aGUgaGlnaFdhdGVyTWFyaywgdGhlbiBhbHNvIHJlYWQgc29tZQoKICBpZiAoc3RhdGUubGVuZ3RoID09PSAwIHx8IHN0YXRlLmxlbmd0aCAtIG4gPCBzdGF0ZS5oaWdoV2F0ZXJNYXJrKSB7CiAgICBkb1JlYWQgPSB0cnVlOwogICAgZGVidWcoJ2xlbmd0aCBsZXNzIHRoYW4gd2F0ZXJtYXJrJywgZG9SZWFkKTsKICB9IC8vIGhvd2V2ZXIsIGlmIHdlJ3ZlIGVuZGVkLCB0aGVuIHRoZXJlJ3Mgbm8gcG9pbnQsIGFuZCBpZiB3ZSdyZSBhbHJlYWR5CiAgLy8gcmVhZGluZywgdGhlbiBpdCdzIHVubmVjZXNzYXJ5LgoKCiAgaWYgKHN0YXRlLmVuZGVkIHx8IHN0YXRlLnJlYWRpbmcpIHsKICAgIGRvUmVhZCA9IGZhbHNlOwogICAgZGVidWcoJ3JlYWRpbmcgb3IgZW5kZWQnLCBkb1JlYWQpOwogIH0gZWxzZSBpZiAoZG9SZWFkKSB7CiAgICBkZWJ1ZygnZG8gcmVhZCcpOwogICAgc3RhdGUucmVhZGluZyA9IHRydWU7CiAgICBzdGF0ZS5zeW5jID0gdHJ1ZTsgLy8gaWYgdGhlIGxlbmd0aCBpcyBjdXJyZW50bHkgemVybywgdGhlbiB3ZSAqbmVlZCogYSByZWFkYWJsZSBldmVudC4KCiAgICBpZiAoc3RhdGUubGVuZ3RoID09PSAwKSBzdGF0ZS5uZWVkUmVhZGFibGUgPSB0cnVlOyAvLyBjYWxsIGludGVybmFsIHJlYWQgbWV0aG9kCgogICAgdGhpcy5fcmVhZChzdGF0ZS5oaWdoV2F0ZXJNYXJrKTsKCiAgICBzdGF0ZS5zeW5jID0gZmFsc2U7IC8vIElmIF9yZWFkIHB1c2hlZCBkYXRhIHN5bmNocm9ub3VzbHksIHRoZW4gYHJlYWRpbmdgIHdpbGwgYmUgZmFsc2UsCiAgICAvLyBhbmQgd2UgbmVlZCB0byByZS1ldmFsdWF0ZSBob3cgbXVjaCBkYXRhIHdlIGNhbiByZXR1cm4gdG8gdGhlIHVzZXIuCgogICAgaWYgKCFzdGF0ZS5yZWFkaW5nKSBuID0gaG93TXVjaFRvUmVhZChuT3JpZywgc3RhdGUpOwogIH0KCiAgdmFyIHJldDsKICBpZiAobiA+IDApIHJldCA9IGZyb21MaXN0KG4sIHN0YXRlKTtlbHNlIHJldCA9IG51bGw7CgogIGlmIChyZXQgPT09IG51bGwpIHsKICAgIHN0YXRlLm5lZWRSZWFkYWJsZSA9IHRydWU7CiAgICBuID0gMDsKICB9IGVsc2UgewogICAgc3RhdGUubGVuZ3RoIC09IG47CiAgfQoKICBpZiAoc3RhdGUubGVuZ3RoID09PSAwKSB7CiAgICAvLyBJZiB3ZSBoYXZlIG5vdGhpbmcgaW4gdGhlIGJ1ZmZlciwgdGhlbiB3ZSB3YW50IHRvIGtub3cKICAgIC8vIGFzIHNvb24gYXMgd2UgKmRvKiBnZXQgc29tZXRoaW5nIGludG8gdGhlIGJ1ZmZlci4KICAgIGlmICghc3RhdGUuZW5kZWQpIHN0YXRlLm5lZWRSZWFkYWJsZSA9IHRydWU7IC8vIElmIHdlIHRyaWVkIHRvIHJlYWQoKSBwYXN0IHRoZSBFT0YsIHRoZW4gZW1pdCBlbmQgb24gdGhlIG5leHQgdGljay4KCiAgICBpZiAobk9yaWcgIT09IG4gJiYgc3RhdGUuZW5kZWQpIGVuZFJlYWRhYmxlKHRoaXMpOwogIH0KCiAgaWYgKHJldCAhPT0gbnVsbCkgdGhpcy5lbWl0KCdkYXRhJywgcmV0KTsKICByZXR1cm4gcmV0Owp9OwoKZnVuY3Rpb24gb25Fb2ZDaHVuayhzdHJlYW0sIHN0YXRlKSB7CiAgaWYgKHN0YXRlLmVuZGVkKSByZXR1cm47CgogIGlmIChzdGF0ZS5kZWNvZGVyKSB7CiAgICB2YXIgY2h1bmsgPSBzdGF0ZS5kZWNvZGVyLmVuZCgpOwoKICAgIGlmIChjaHVuayAmJiBjaHVuay5sZW5ndGgpIHsKICAgICAgc3RhdGUuYnVmZmVyLnB1c2goY2h1bmspOwogICAgICBzdGF0ZS5sZW5ndGggKz0gc3RhdGUub2JqZWN0TW9kZSA/IDEgOiBjaHVuay5sZW5ndGg7CiAgICB9CiAgfQoKICBzdGF0ZS5lbmRlZCA9IHRydWU7IC8vIGVtaXQgJ3JlYWRhYmxlJyBub3cgdG8gbWFrZSBzdXJlIGl0IGdldHMgcGlja2VkIHVwLgoKICBlbWl0UmVhZGFibGUoc3RyZWFtKTsKfSAvLyBEb24ndCBlbWl0IHJlYWRhYmxlIHJpZ2h0IGF3YXkgaW4gc3luYyBtb2RlLCBiZWNhdXNlIHRoaXMgY2FuIHRyaWdnZXIKLy8gYW5vdGhlciByZWFkKCkgY2FsbCA9PiBzdGFjayBvdmVyZmxvdy4gIFRoaXMgd2F5LCBpdCBtaWdodCB0cmlnZ2VyCi8vIGEgbmV4dFRpY2sgcmVjdXJzaW9uIHdhcm5pbmcsIGJ1dCB0aGF0J3Mgbm90IHNvIGJhZC4KCgpmdW5jdGlvbiBlbWl0UmVhZGFibGUoc3RyZWFtKSB7CiAgdmFyIHN0YXRlID0gc3RyZWFtLl9yZWFkYWJsZVN0YXRlOwogIHN0YXRlLm5lZWRSZWFkYWJsZSA9IGZhbHNlOwoKICBpZiAoIXN0YXRlLmVtaXR0ZWRSZWFkYWJsZSkgewogICAgZGVidWcoJ2VtaXRSZWFkYWJsZScsIHN0YXRlLmZsb3dpbmcpOwogICAgc3RhdGUuZW1pdHRlZFJlYWRhYmxlID0gdHJ1ZTsKICAgIGlmIChzdGF0ZS5zeW5jKSBwbmEubmV4dFRpY2soZW1pdFJlYWRhYmxlXywgc3RyZWFtKTtlbHNlIGVtaXRSZWFkYWJsZV8oc3RyZWFtKTsKICB9Cn0KCmZ1bmN0aW9uIGVtaXRSZWFkYWJsZV8oc3RyZWFtKSB7CiAgZGVidWcoJ2VtaXQgcmVhZGFibGUnKTsKICBzdHJlYW0uZW1pdCgncmVhZGFibGUnKTsKICBmbG93KHN0cmVhbSk7Cn0gLy8gYXQgdGhpcyBwb2ludCwgdGhlIHVzZXIgaGFzIHByZXN1bWFibHkgc2VlbiB0aGUgJ3JlYWRhYmxlJyBldmVudCwKLy8gYW5kIGNhbGxlZCByZWFkKCkgdG8gY29uc3VtZSBzb21lIGRhdGEuICB0aGF0IG1heSBoYXZlIHRyaWdnZXJlZAovLyBpbiB0dXJuIGFub3RoZXIgX3JlYWQobikgY2FsbCwgaW4gd2hpY2ggY2FzZSByZWFkaW5nID0gdHJ1ZSBpZgovLyBpdCdzIGluIHByb2dyZXNzLgovLyBIb3dldmVyLCBpZiB3ZSdyZSBub3QgZW5kZWQsIG9yIHJlYWRpbmcsIGFuZCB0aGUgbGVuZ3RoIDwgaHdtLAovLyB0aGVuIGdvIGFoZWFkIGFuZCB0cnkgdG8gcmVhZCBzb21lIG1vcmUgcHJlZW1wdGl2ZWx5LgoKCmZ1bmN0aW9uIG1heWJlUmVhZE1vcmUoc3RyZWFtLCBzdGF0ZSkgewogIGlmICghc3RhdGUucmVhZGluZ01vcmUpIHsKICAgIHN0YXRlLnJlYWRpbmdNb3JlID0gdHJ1ZTsKICAgIHBuYS5uZXh0VGljayhtYXliZVJlYWRNb3JlXywgc3RyZWFtLCBzdGF0ZSk7CiAgfQp9CgpmdW5jdGlvbiBtYXliZVJlYWRNb3JlXyhzdHJlYW0sIHN0YXRlKSB7CiAgdmFyIGxlbiA9IHN0YXRlLmxlbmd0aDsKCiAgd2hpbGUgKCFzdGF0ZS5yZWFkaW5nICYmICFzdGF0ZS5mbG93aW5nICYmICFzdGF0ZS5lbmRlZCAmJiBzdGF0ZS5sZW5ndGggPCBzdGF0ZS5oaWdoV2F0ZXJNYXJrKSB7CiAgICBkZWJ1ZygnbWF5YmVSZWFkTW9yZSByZWFkIDAnKTsKICAgIHN0cmVhbS5yZWFkKDApOwogICAgaWYgKGxlbiA9PT0gc3RhdGUubGVuZ3RoKSAvLyBkaWRuJ3QgZ2V0IGFueSBkYXRhLCBzdG9wIHNwaW5uaW5nLgogICAgICBicmVhaztlbHNlIGxlbiA9IHN0YXRlLmxlbmd0aDsKICB9CgogIHN0YXRlLnJlYWRpbmdNb3JlID0gZmFsc2U7Cn0gLy8gYWJzdHJhY3QgbWV0aG9kLiAgdG8gYmUgb3ZlcnJpZGRlbiBpbiBzcGVjaWZpYyBpbXBsZW1lbnRhdGlvbiBjbGFzc2VzLgovLyBjYWxsIGNiKGVyLCBkYXRhKSB3aGVyZSBkYXRhIGlzIDw9IG4gaW4gbGVuZ3RoLgovLyBmb3IgdmlydHVhbCAobm9uLXN0cmluZywgbm9uLWJ1ZmZlcikgc3RyZWFtcywgImxlbmd0aCIgaXMgc29tZXdoYXQKLy8gYXJiaXRyYXJ5LCBhbmQgcGVyaGFwcyBub3QgdmVyeSBtZWFuaW5nZnVsLgoKClJlYWRhYmxlLnByb3RvdHlwZS5fcmVhZCA9IGZ1bmN0aW9uIChuKSB7CiAgdGhpcy5lbWl0KCdlcnJvcicsIG5ldyBFcnJvcignX3JlYWQoKSBpcyBub3QgaW1wbGVtZW50ZWQnKSk7Cn07CgpSZWFkYWJsZS5wcm90b3R5cGUucGlwZSA9IGZ1bmN0aW9uIChkZXN0LCBwaXBlT3B0cykgewogIHZhciBzcmMgPSB0aGlzOwogIHZhciBzdGF0ZSA9IHRoaXMuX3JlYWRhYmxlU3RhdGU7CgogIHN3aXRjaCAoc3RhdGUucGlwZXNDb3VudCkgewogICAgY2FzZSAwOgogICAgICBzdGF0ZS5waXBlcyA9IGRlc3Q7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgMToKICAgICAgc3RhdGUucGlwZXMgPSBbc3RhdGUucGlwZXMsIGRlc3RdOwogICAgICBicmVhazsKCiAgICBkZWZhdWx0OgogICAgICBzdGF0ZS5waXBlcy5wdXNoKGRlc3QpOwogICAgICBicmVhazsKICB9CgogIHN0YXRlLnBpcGVzQ291bnQgKz0gMTsKICBkZWJ1ZygncGlwZSBjb3VudD0lZCBvcHRzPSVqJywgc3RhdGUucGlwZXNDb3VudCwgcGlwZU9wdHMpOwogIHZhciBkb0VuZCA9ICghcGlwZU9wdHMgfHwgcGlwZU9wdHMuZW5kICE9PSBmYWxzZSkgJiYgZGVzdCAhPT0gcHJvY2Vzcy5zdGRvdXQgJiYgZGVzdCAhPT0gcHJvY2Vzcy5zdGRlcnI7CiAgdmFyIGVuZEZuID0gZG9FbmQgPyBvbmVuZCA6IHVucGlwZTsKICBpZiAoc3RhdGUuZW5kRW1pdHRlZCkgcG5hLm5leHRUaWNrKGVuZEZuKTtlbHNlIHNyYy5vbmNlKCdlbmQnLCBlbmRGbik7CiAgZGVzdC5vbigndW5waXBlJywgb251bnBpcGUpOwoKICBmdW5jdGlvbiBvbnVucGlwZShyZWFkYWJsZSwgdW5waXBlSW5mbykgewogICAgZGVidWcoJ29udW5waXBlJyk7CgogICAgaWYgKHJlYWRhYmxlID09PSBzcmMpIHsKICAgICAgaWYgKHVucGlwZUluZm8gJiYgdW5waXBlSW5mby5oYXNVbnBpcGVkID09PSBmYWxzZSkgewogICAgICAgIHVucGlwZUluZm8uaGFzVW5waXBlZCA9IHRydWU7CiAgICAgICAgY2xlYW51cCgpOwogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBvbmVuZCgpIHsKICAgIGRlYnVnKCdvbmVuZCcpOwogICAgZGVzdC5lbmQoKTsKICB9IC8vIHdoZW4gdGhlIGRlc3QgZHJhaW5zLCBpdCByZWR1Y2VzIHRoZSBhd2FpdERyYWluIGNvdW50ZXIKICAvLyBvbiB0aGUgc291cmNlLiAgVGhpcyB3b3VsZCBiZSBtb3JlIGVsZWdhbnQgd2l0aCBhIC5vbmNlKCkKICAvLyBoYW5kbGVyIGluIGZsb3coKSwgYnV0IGFkZGluZyBhbmQgcmVtb3ZpbmcgcmVwZWF0ZWRseSBpcwogIC8vIHRvbyBzbG93LgoKCiAgdmFyIG9uZHJhaW4gPSBwaXBlT25EcmFpbihzcmMpOwogIGRlc3Qub24oJ2RyYWluJywgb25kcmFpbik7CiAgdmFyIGNsZWFuZWRVcCA9IGZhbHNlOwoKICBmdW5jdGlvbiBjbGVhbnVwKCkgewogICAgZGVidWcoJ2NsZWFudXAnKTsgLy8gY2xlYW51cCBldmVudCBoYW5kbGVycyBvbmNlIHRoZSBwaXBlIGlzIGJyb2tlbgoKICAgIGRlc3QucmVtb3ZlTGlzdGVuZXIoJ2Nsb3NlJywgb25jbG9zZSk7CiAgICBkZXN0LnJlbW92ZUxpc3RlbmVyKCdmaW5pc2gnLCBvbmZpbmlzaCk7CiAgICBkZXN0LnJlbW92ZUxpc3RlbmVyKCdkcmFpbicsIG9uZHJhaW4pOwogICAgZGVzdC5yZW1vdmVMaXN0ZW5lcignZXJyb3InLCBvbmVycm9yKTsKICAgIGRlc3QucmVtb3ZlTGlzdGVuZXIoJ3VucGlwZScsIG9udW5waXBlKTsKICAgIHNyYy5yZW1vdmVMaXN0ZW5lcignZW5kJywgb25lbmQpOwogICAgc3JjLnJlbW92ZUxpc3RlbmVyKCdlbmQnLCB1bnBpcGUpOwogICAgc3JjLnJlbW92ZUxpc3RlbmVyKCdkYXRhJywgb25kYXRhKTsKICAgIGNsZWFuZWRVcCA9IHRydWU7IC8vIGlmIHRoZSByZWFkZXIgaXMgd2FpdGluZyBmb3IgYSBkcmFpbiBldmVudCBmcm9tIHRoaXMKICAgIC8vIHNwZWNpZmljIHdyaXRlciwgdGhlbiBpdCB3b3VsZCBjYXVzZSBpdCB0byBuZXZlciBzdGFydAogICAgLy8gZmxvd2luZyBhZ2Fpbi4KICAgIC8vIFNvLCBpZiB0aGlzIGlzIGF3YWl0aW5nIGEgZHJhaW4sIHRoZW4gd2UganVzdCBjYWxsIGl0IG5vdy4KICAgIC8vIElmIHdlIGRvbid0IGtub3csIHRoZW4gYXNzdW1lIHRoYXQgd2UgYXJlIHdhaXRpbmcgZm9yIG9uZS4KCiAgICBpZiAoc3RhdGUuYXdhaXREcmFpbiAmJiAoIWRlc3QuX3dyaXRhYmxlU3RhdGUgfHwgZGVzdC5fd3JpdGFibGVTdGF0ZS5uZWVkRHJhaW4pKSBvbmRyYWluKCk7CiAgfSAvLyBJZiB0aGUgdXNlciBwdXNoZXMgbW9yZSBkYXRhIHdoaWxlIHdlJ3JlIHdyaXRpbmcgdG8gZGVzdCB0aGVuIHdlJ2xsIGVuZCB1cAogIC8vIGluIG9uZGF0YSBhZ2Fpbi4gSG93ZXZlciwgd2Ugb25seSB3YW50IHRvIGluY3JlYXNlIGF3YWl0RHJhaW4gb25jZSBiZWNhdXNlCiAgLy8gZGVzdCB3aWxsIG9ubHkgZW1pdCBvbmUgJ2RyYWluJyBldmVudCBmb3IgdGhlIG11bHRpcGxlIHdyaXRlcy4KICAvLyA9PiBJbnRyb2R1Y2UgYSBndWFyZCBvbiBpbmNyZWFzaW5nIGF3YWl0RHJhaW4uCgoKICB2YXIgaW5jcmVhc2VkQXdhaXREcmFpbiA9IGZhbHNlOwogIHNyYy5vbignZGF0YScsIG9uZGF0YSk7CgogIGZ1bmN0aW9uIG9uZGF0YShjaHVuaykgewogICAgZGVidWcoJ29uZGF0YScpOwogICAgaW5jcmVhc2VkQXdhaXREcmFpbiA9IGZhbHNlOwogICAgdmFyIHJldCA9IGRlc3Qud3JpdGUoY2h1bmspOwoKICAgIGlmIChmYWxzZSA9PT0gcmV0ICYmICFpbmNyZWFzZWRBd2FpdERyYWluKSB7CiAgICAgIC8vIElmIHRoZSB1c2VyIHVucGlwZWQgZHVyaW5nIGBkZXN0LndyaXRlKClgLCBpdCBpcyBwb3NzaWJsZQogICAgICAvLyB0byBnZXQgc3R1Y2sgaW4gYSBwZXJtYW5lbnRseSBwYXVzZWQgc3RhdGUgaWYgdGhhdCB3cml0ZQogICAgICAvLyBhbHNvIHJldHVybmVkIGZhbHNlLgogICAgICAvLyA9PiBDaGVjayB3aGV0aGVyIGBkZXN0YCBpcyBzdGlsbCBhIHBpcGluZyBkZXN0aW5hdGlvbi4KICAgICAgaWYgKChzdGF0ZS5waXBlc0NvdW50ID09PSAxICYmIHN0YXRlLnBpcGVzID09PSBkZXN0IHx8IHN0YXRlLnBpcGVzQ291bnQgPiAxICYmIGluZGV4T2Yoc3RhdGUucGlwZXMsIGRlc3QpICE9PSAtMSkgJiYgIWNsZWFuZWRVcCkgewogICAgICAgIGRlYnVnKCdmYWxzZSB3cml0ZSByZXNwb25zZSwgcGF1c2UnLCBzcmMuX3JlYWRhYmxlU3RhdGUuYXdhaXREcmFpbik7CiAgICAgICAgc3JjLl9yZWFkYWJsZVN0YXRlLmF3YWl0RHJhaW4rKzsKICAgICAgICBpbmNyZWFzZWRBd2FpdERyYWluID0gdHJ1ZTsKICAgICAgfQoKICAgICAgc3JjLnBhdXNlKCk7CiAgICB9CiAgfSAvLyBpZiB0aGUgZGVzdCBoYXMgYW4gZXJyb3IsIHRoZW4gc3RvcCBwaXBpbmcgaW50byBpdC4KICAvLyBob3dldmVyLCBkb24ndCBzdXBwcmVzcyB0aGUgdGhyb3dpbmcgYmVoYXZpb3IgZm9yIHRoaXMuCgoKICBmdW5jdGlvbiBvbmVycm9yKGVyKSB7CiAgICBkZWJ1Zygnb25lcnJvcicsIGVyKTsKICAgIHVucGlwZSgpOwogICAgZGVzdC5yZW1vdmVMaXN0ZW5lcignZXJyb3InLCBvbmVycm9yKTsKICAgIGlmIChFRWxpc3RlbmVyQ291bnQoZGVzdCwgJ2Vycm9yJykgPT09IDApIGRlc3QuZW1pdCgnZXJyb3InLCBlcik7CiAgfSAvLyBNYWtlIHN1cmUgb3VyIGVycm9yIGhhbmRsZXIgaXMgYXR0YWNoZWQgYmVmb3JlIHVzZXJsYW5kIG9uZXMuCgoKICBwcmVwZW5kTGlzdGVuZXIoZGVzdCwgJ2Vycm9yJywgb25lcnJvcik7IC8vIEJvdGggY2xvc2UgYW5kIGZpbmlzaCBzaG91bGQgdHJpZ2dlciB1bnBpcGUsIGJ1dCBvbmx5IG9uY2UuCgogIGZ1bmN0aW9uIG9uY2xvc2UoKSB7CiAgICBkZXN0LnJlbW92ZUxpc3RlbmVyKCdmaW5pc2gnLCBvbmZpbmlzaCk7CiAgICB1bnBpcGUoKTsKICB9CgogIGRlc3Qub25jZSgnY2xvc2UnLCBvbmNsb3NlKTsKCiAgZnVuY3Rpb24gb25maW5pc2goKSB7CiAgICBkZWJ1Zygnb25maW5pc2gnKTsKICAgIGRlc3QucmVtb3ZlTGlzdGVuZXIoJ2Nsb3NlJywgb25jbG9zZSk7CiAgICB1bnBpcGUoKTsKICB9CgogIGRlc3Qub25jZSgnZmluaXNoJywgb25maW5pc2gpOwoKICBmdW5jdGlvbiB1bnBpcGUoKSB7CiAgICBkZWJ1ZygndW5waXBlJyk7CiAgICBzcmMudW5waXBlKGRlc3QpOwogIH0gLy8gdGVsbCB0aGUgZGVzdCB0aGF0IGl0J3MgYmVpbmcgcGlwZWQgdG8KCgogIGRlc3QuZW1pdCgncGlwZScsIHNyYyk7IC8vIHN0YXJ0IHRoZSBmbG93IGlmIGl0IGhhc24ndCBiZWVuIHN0YXJ0ZWQgYWxyZWFkeS4KCiAgaWYgKCFzdGF0ZS5mbG93aW5nKSB7CiAgICBkZWJ1ZygncGlwZSByZXN1bWUnKTsKICAgIHNyYy5yZXN1bWUoKTsKICB9CgogIHJldHVybiBkZXN0Owp9OwoKZnVuY3Rpb24gcGlwZU9uRHJhaW4oc3JjKSB7CiAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgIHZhciBzdGF0ZSA9IHNyYy5fcmVhZGFibGVTdGF0ZTsKICAgIGRlYnVnKCdwaXBlT25EcmFpbicsIHN0YXRlLmF3YWl0RHJhaW4pOwogICAgaWYgKHN0YXRlLmF3YWl0RHJhaW4pIHN0YXRlLmF3YWl0RHJhaW4tLTsKCiAgICBpZiAoc3RhdGUuYXdhaXREcmFpbiA9PT0gMCAmJiBFRWxpc3RlbmVyQ291bnQoc3JjLCAnZGF0YScpKSB7CiAgICAgIHN0YXRlLmZsb3dpbmcgPSB0cnVlOwogICAgICBmbG93KHNyYyk7CiAgICB9CiAgfTsKfQoKUmVhZGFibGUucHJvdG90eXBlLnVucGlwZSA9IGZ1bmN0aW9uIChkZXN0KSB7CiAgdmFyIHN0YXRlID0gdGhpcy5fcmVhZGFibGVTdGF0ZTsKICB2YXIgdW5waXBlSW5mbyA9IHsKICAgIGhhc1VucGlwZWQ6IGZhbHNlCiAgfTsgLy8gaWYgd2UncmUgbm90IHBpcGluZyBhbnl3aGVyZSwgdGhlbiBkbyBub3RoaW5nLgoKICBpZiAoc3RhdGUucGlwZXNDb3VudCA9PT0gMCkgcmV0dXJuIHRoaXM7IC8vIGp1c3Qgb25lIGRlc3RpbmF0aW9uLiAgbW9zdCBjb21tb24gY2FzZS4KCiAgaWYgKHN0YXRlLnBpcGVzQ291bnQgPT09IDEpIHsKICAgIC8vIHBhc3NlZCBpbiBvbmUsIGJ1dCBpdCdzIG5vdCB0aGUgcmlnaHQgb25lLgogICAgaWYgKGRlc3QgJiYgZGVzdCAhPT0gc3RhdGUucGlwZXMpIHJldHVybiB0aGlzOwogICAgaWYgKCFkZXN0KSBkZXN0ID0gc3RhdGUucGlwZXM7IC8vIGdvdCBhIG1hdGNoLgoKICAgIHN0YXRlLnBpcGVzID0gbnVsbDsKICAgIHN0YXRlLnBpcGVzQ291bnQgPSAwOwogICAgc3RhdGUuZmxvd2luZyA9IGZhbHNlOwogICAgaWYgKGRlc3QpIGRlc3QuZW1pdCgndW5waXBlJywgdGhpcywgdW5waXBlSW5mbyk7CiAgICByZXR1cm4gdGhpczsKICB9IC8vIHNsb3cgY2FzZS4gbXVsdGlwbGUgcGlwZSBkZXN0aW5hdGlvbnMuCgoKICBpZiAoIWRlc3QpIHsKICAgIC8vIHJlbW92ZSBhbGwuCiAgICB2YXIgZGVzdHMgPSBzdGF0ZS5waXBlczsKICAgIHZhciBsZW4gPSBzdGF0ZS5waXBlc0NvdW50OwogICAgc3RhdGUucGlwZXMgPSBudWxsOwogICAgc3RhdGUucGlwZXNDb3VudCA9IDA7CiAgICBzdGF0ZS5mbG93aW5nID0gZmFsc2U7CgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgewogICAgICBkZXN0c1tpXS5lbWl0KCd1bnBpcGUnLCB0aGlzLCB1bnBpcGVJbmZvKTsKICAgIH0KCiAgICByZXR1cm4gdGhpczsKICB9IC8vIHRyeSB0byBmaW5kIHRoZSByaWdodCBvbmUuCgoKICB2YXIgaW5kZXggPSBpbmRleE9mKHN0YXRlLnBpcGVzLCBkZXN0KTsKICBpZiAoaW5kZXggPT09IC0xKSByZXR1cm4gdGhpczsKICBzdGF0ZS5waXBlcy5zcGxpY2UoaW5kZXgsIDEpOwogIHN0YXRlLnBpcGVzQ291bnQgLT0gMTsKICBpZiAoc3RhdGUucGlwZXNDb3VudCA9PT0gMSkgc3RhdGUucGlwZXMgPSBzdGF0ZS5waXBlc1swXTsKICBkZXN0LmVtaXQoJ3VucGlwZScsIHRoaXMsIHVucGlwZUluZm8pOwogIHJldHVybiB0aGlzOwp9OyAvLyBzZXQgdXAgZGF0YSBldmVudHMgaWYgdGhleSBhcmUgYXNrZWQgZm9yCi8vIEVuc3VyZSByZWFkYWJsZSBsaXN0ZW5lcnMgZXZlbnR1YWxseSBnZXQgc29tZXRoaW5nCgoKUmVhZGFibGUucHJvdG90eXBlLm9uID0gZnVuY3Rpb24gKGV2LCBmbikgewogIHZhciByZXMgPSBTdHJlYW0ucHJvdG90eXBlLm9uLmNhbGwodGhpcywgZXYsIGZuKTsKCiAgaWYgKGV2ID09PSAnZGF0YScpIHsKICAgIC8vIFN0YXJ0IGZsb3dpbmcgb24gbmV4dCB0aWNrIGlmIHN0cmVhbSBpc24ndCBleHBsaWNpdGx5IHBhdXNlZAogICAgaWYgKHRoaXMuX3JlYWRhYmxlU3RhdGUuZmxvd2luZyAhPT0gZmFsc2UpIHRoaXMucmVzdW1lKCk7CiAgfSBlbHNlIGlmIChldiA9PT0gJ3JlYWRhYmxlJykgewogICAgdmFyIHN0YXRlID0gdGhpcy5fcmVhZGFibGVTdGF0ZTsKCiAgICBpZiAoIXN0YXRlLmVuZEVtaXR0ZWQgJiYgIXN0YXRlLnJlYWRhYmxlTGlzdGVuaW5nKSB7CiAgICAgIHN0YXRlLnJlYWRhYmxlTGlzdGVuaW5nID0gc3RhdGUubmVlZFJlYWRhYmxlID0gdHJ1ZTsKICAgICAgc3RhdGUuZW1pdHRlZFJlYWRhYmxlID0gZmFsc2U7CgogICAgICBpZiAoIXN0YXRlLnJlYWRpbmcpIHsKICAgICAgICBwbmEubmV4dFRpY2soblJlYWRpbmdOZXh0VGljaywgdGhpcyk7CiAgICAgIH0gZWxzZSBpZiAoc3RhdGUubGVuZ3RoKSB7CiAgICAgICAgZW1pdFJlYWRhYmxlKHRoaXMpOwogICAgICB9CiAgICB9CiAgfQoKICByZXR1cm4gcmVzOwp9OwoKUmVhZGFibGUucHJvdG90eXBlLmFkZExpc3RlbmVyID0gUmVhZGFibGUucHJvdG90eXBlLm9uOwoKZnVuY3Rpb24gblJlYWRpbmdOZXh0VGljayhzZWxmKSB7CiAgZGVidWcoJ3JlYWRhYmxlIG5leHR0aWNrIHJlYWQgMCcpOwogIHNlbGYucmVhZCgwKTsKfSAvLyBwYXVzZSgpIGFuZCByZXN1bWUoKSBhcmUgcmVtbmFudHMgb2YgdGhlIGxlZ2FjeSByZWFkYWJsZSBzdHJlYW0gQVBJCi8vIElmIHRoZSB1c2VyIHVzZXMgdGhlbSwgdGhlbiBzd2l0Y2ggaW50byBvbGQgbW9kZS4KCgpSZWFkYWJsZS5wcm90b3R5cGUucmVzdW1lID0gZnVuY3Rpb24gKCkgewogIHZhciBzdGF0ZSA9IHRoaXMuX3JlYWRhYmxlU3RhdGU7CgogIGlmICghc3RhdGUuZmxvd2luZykgewogICAgZGVidWcoJ3Jlc3VtZScpOwogICAgc3RhdGUuZmxvd2luZyA9IHRydWU7CiAgICByZXN1bWUodGhpcywgc3RhdGUpOwogIH0KCiAgcmV0dXJuIHRoaXM7Cn07CgpmdW5jdGlvbiByZXN1bWUoc3RyZWFtLCBzdGF0ZSkgewogIGlmICghc3RhdGUucmVzdW1lU2NoZWR1bGVkKSB7CiAgICBzdGF0ZS5yZXN1bWVTY2hlZHVsZWQgPSB0cnVlOwogICAgcG5hLm5leHRUaWNrKHJlc3VtZV8sIHN0cmVhbSwgc3RhdGUpOwogIH0KfQoKZnVuY3Rpb24gcmVzdW1lXyhzdHJlYW0sIHN0YXRlKSB7CiAgaWYgKCFzdGF0ZS5yZWFkaW5nKSB7CiAgICBkZWJ1ZygncmVzdW1lIHJlYWQgMCcpOwogICAgc3RyZWFtLnJlYWQoMCk7CiAgfQoKICBzdGF0ZS5yZXN1bWVTY2hlZHVsZWQgPSBmYWxzZTsKICBzdGF0ZS5hd2FpdERyYWluID0gMDsKICBzdHJlYW0uZW1pdCgncmVzdW1lJyk7CiAgZmxvdyhzdHJlYW0pOwogIGlmIChzdGF0ZS5mbG93aW5nICYmICFzdGF0ZS5yZWFkaW5nKSBzdHJlYW0ucmVhZCgwKTsKfQoKUmVhZGFibGUucHJvdG90eXBlLnBhdXNlID0gZnVuY3Rpb24gKCkgewogIGRlYnVnKCdjYWxsIHBhdXNlIGZsb3dpbmc9JWonLCB0aGlzLl9yZWFkYWJsZVN0YXRlLmZsb3dpbmcpOwoKICBpZiAoZmFsc2UgIT09IHRoaXMuX3JlYWRhYmxlU3RhdGUuZmxvd2luZykgewogICAgZGVidWcoJ3BhdXNlJyk7CiAgICB0aGlzLl9yZWFkYWJsZVN0YXRlLmZsb3dpbmcgPSBmYWxzZTsKICAgIHRoaXMuZW1pdCgncGF1c2UnKTsKICB9CgogIHJldHVybiB0aGlzOwp9OwoKZnVuY3Rpb24gZmxvdyhzdHJlYW0pIHsKICB2YXIgc3RhdGUgPSBzdHJlYW0uX3JlYWRhYmxlU3RhdGU7CiAgZGVidWcoJ2Zsb3cnLCBzdGF0ZS5mbG93aW5nKTsKCiAgd2hpbGUgKHN0YXRlLmZsb3dpbmcgJiYgc3RyZWFtLnJlYWQoKSAhPT0gbnVsbCkge30KfSAvLyB3cmFwIGFuIG9sZC1zdHlsZSBzdHJlYW0gYXMgdGhlIGFzeW5jIGRhdGEgc291cmNlLgovLyBUaGlzIGlzICpub3QqIHBhcnQgb2YgdGhlIHJlYWRhYmxlIHN0cmVhbSBpbnRlcmZhY2UuCi8vIEl0IGlzIGFuIHVnbHkgdW5mb3J0dW5hdGUgbWVzcyBvZiBoaXN0b3J5LgoKClJlYWRhYmxlLnByb3RvdHlwZS53cmFwID0gZnVuY3Rpb24gKHN0cmVhbSkgewogIHZhciBfdGhpcyA9IHRoaXM7CgogIHZhciBzdGF0ZSA9IHRoaXMuX3JlYWRhYmxlU3RhdGU7CiAgdmFyIHBhdXNlZCA9IGZhbHNlOwogIHN0cmVhbS5vbignZW5kJywgZnVuY3Rpb24gKCkgewogICAgZGVidWcoJ3dyYXBwZWQgZW5kJyk7CgogICAgaWYgKHN0YXRlLmRlY29kZXIgJiYgIXN0YXRlLmVuZGVkKSB7CiAgICAgIHZhciBjaHVuayA9IHN0YXRlLmRlY29kZXIuZW5kKCk7CiAgICAgIGlmIChjaHVuayAmJiBjaHVuay5sZW5ndGgpIF90aGlzLnB1c2goY2h1bmspOwogICAgfQoKICAgIF90aGlzLnB1c2gobnVsbCk7CiAgfSk7CiAgc3RyZWFtLm9uKCdkYXRhJywgZnVuY3Rpb24gKGNodW5rKSB7CiAgICBkZWJ1Zygnd3JhcHBlZCBkYXRhJyk7CiAgICBpZiAoc3RhdGUuZGVjb2RlcikgY2h1bmsgPSBzdGF0ZS5kZWNvZGVyLndyaXRlKGNodW5rKTsgLy8gZG9uJ3Qgc2tpcCBvdmVyIGZhbHN5IHZhbHVlcyBpbiBvYmplY3RNb2RlCgogICAgaWYgKHN0YXRlLm9iamVjdE1vZGUgJiYgKGNodW5rID09PSBudWxsIHx8IGNodW5rID09PSB1bmRlZmluZWQpKSByZXR1cm47ZWxzZSBpZiAoIXN0YXRlLm9iamVjdE1vZGUgJiYgKCFjaHVuayB8fCAhY2h1bmsubGVuZ3RoKSkgcmV0dXJuOwoKICAgIHZhciByZXQgPSBfdGhpcy5wdXNoKGNodW5rKTsKCiAgICBpZiAoIXJldCkgewogICAgICBwYXVzZWQgPSB0cnVlOwogICAgICBzdHJlYW0ucGF1c2UoKTsKICAgIH0KICB9KTsgLy8gcHJveHkgYWxsIHRoZSBvdGhlciBtZXRob2RzLgogIC8vIGltcG9ydGFudCB3aGVuIHdyYXBwaW5nIGZpbHRlcnMgYW5kIGR1cGxleGVzLgoKICBmb3IgKHZhciBpIGluIHN0cmVhbSkgewogICAgaWYgKHRoaXNbaV0gPT09IHVuZGVmaW5lZCAmJiB0eXBlb2Ygc3RyZWFtW2ldID09PSAnZnVuY3Rpb24nKSB7CiAgICAgIHRoaXNbaV0gPSBmdW5jdGlvbiAobWV0aG9kKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBzdHJlYW1bbWV0aG9kXS5hcHBseShzdHJlYW0sIGFyZ3VtZW50cyk7CiAgICAgICAgfTsKICAgICAgfShpKTsKICAgIH0KICB9IC8vIHByb3h5IGNlcnRhaW4gaW1wb3J0YW50IGV2ZW50cy4KCgogIGZvciAodmFyIG4gPSAwOyBuIDwga1Byb3h5RXZlbnRzLmxlbmd0aDsgbisrKSB7CiAgICBzdHJlYW0ub24oa1Byb3h5RXZlbnRzW25dLCB0aGlzLmVtaXQuYmluZCh0aGlzLCBrUHJveHlFdmVudHNbbl0pKTsKICB9IC8vIHdoZW4gd2UgdHJ5IHRvIGNvbnN1bWUgc29tZSBtb3JlIGJ5dGVzLCBzaW1wbHkgdW5wYXVzZSB0aGUKICAvLyB1bmRlcmx5aW5nIHN0cmVhbS4KCgogIHRoaXMuX3JlYWQgPSBmdW5jdGlvbiAobikgewogICAgZGVidWcoJ3dyYXBwZWQgX3JlYWQnLCBuKTsKCiAgICBpZiAocGF1c2VkKSB7CiAgICAgIHBhdXNlZCA9IGZhbHNlOwogICAgICBzdHJlYW0ucmVzdW1lKCk7CiAgICB9CiAgfTsKCiAgcmV0dXJuIHRoaXM7Cn07CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoUmVhZGFibGUucHJvdG90eXBlLCAncmVhZGFibGVIaWdoV2F0ZXJNYXJrJywgewogIC8vIG1ha2luZyBpdCBleHBsaWNpdCB0aGlzIHByb3BlcnR5IGlzIG5vdCBlbnVtZXJhYmxlCiAgLy8gYmVjYXVzZSBvdGhlcndpc2Ugc29tZSBwcm90b3R5cGUgbWFuaXB1bGF0aW9uIGluCiAgLy8gdXNlcmxhbmQgd2lsbCBmYWlsCiAgZW51bWVyYWJsZTogZmFsc2UsCiAgZ2V0OiBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5fcmVhZGFibGVTdGF0ZS5oaWdoV2F0ZXJNYXJrOwogIH0KfSk7IC8vIGV4cG9zZWQgZm9yIHRlc3RpbmcgcHVycG9zZXMgb25seS4KClJlYWRhYmxlLl9mcm9tTGlzdCA9IGZyb21MaXN0OyAvLyBQbHVjayBvZmYgbiBieXRlcyBmcm9tIGFuIGFycmF5IG9mIGJ1ZmZlcnMuCi8vIExlbmd0aCBpcyB0aGUgY29tYmluZWQgbGVuZ3RocyBvZiBhbGwgdGhlIGJ1ZmZlcnMgaW4gdGhlIGxpc3QuCi8vIFRoaXMgZnVuY3Rpb24gaXMgZGVzaWduZWQgdG8gYmUgaW5saW5hYmxlLCBzbyBwbGVhc2UgdGFrZSBjYXJlIHdoZW4gbWFraW5nCi8vIGNoYW5nZXMgdG8gdGhlIGZ1bmN0aW9uIGJvZHkuCgpmdW5jdGlvbiBmcm9tTGlzdChuLCBzdGF0ZSkgewogIC8vIG5vdGhpbmcgYnVmZmVyZWQKICBpZiAoc3RhdGUubGVuZ3RoID09PSAwKSByZXR1cm4gbnVsbDsKICB2YXIgcmV0OwogIGlmIChzdGF0ZS5vYmplY3RNb2RlKSByZXQgPSBzdGF0ZS5idWZmZXIuc2hpZnQoKTtlbHNlIGlmICghbiB8fCBuID49IHN0YXRlLmxlbmd0aCkgewogICAgLy8gcmVhZCBpdCBhbGwsIHRydW5jYXRlIHRoZSBsaXN0CiAgICBpZiAoc3RhdGUuZGVjb2RlcikgcmV0ID0gc3RhdGUuYnVmZmVyLmpvaW4oJycpO2Vsc2UgaWYgKHN0YXRlLmJ1ZmZlci5sZW5ndGggPT09IDEpIHJldCA9IHN0YXRlLmJ1ZmZlci5oZWFkLmRhdGE7ZWxzZSByZXQgPSBzdGF0ZS5idWZmZXIuY29uY2F0KHN0YXRlLmxlbmd0aCk7CiAgICBzdGF0ZS5idWZmZXIuY2xlYXIoKTsKICB9IGVsc2UgewogICAgLy8gcmVhZCBwYXJ0IG9mIGxpc3QKICAgIHJldCA9IGZyb21MaXN0UGFydGlhbChuLCBzdGF0ZS5idWZmZXIsIHN0YXRlLmRlY29kZXIpOwogIH0KICByZXR1cm4gcmV0Owp9IC8vIEV4dHJhY3RzIG9ubHkgZW5vdWdoIGJ1ZmZlcmVkIGRhdGEgdG8gc2F0aXNmeSB0aGUgYW1vdW50IHJlcXVlc3RlZC4KLy8gVGhpcyBmdW5jdGlvbiBpcyBkZXNpZ25lZCB0byBiZSBpbmxpbmFibGUsIHNvIHBsZWFzZSB0YWtlIGNhcmUgd2hlbiBtYWtpbmcKLy8gY2hhbmdlcyB0byB0aGUgZnVuY3Rpb24gYm9keS4KCgpmdW5jdGlvbiBmcm9tTGlzdFBhcnRpYWwobiwgbGlzdCwgaGFzU3RyaW5ncykgewogIHZhciByZXQ7CgogIGlmIChuIDwgbGlzdC5oZWFkLmRhdGEubGVuZ3RoKSB7CiAgICAvLyBzbGljZSBpcyB0aGUgc2FtZSBmb3IgYnVmZmVycyBhbmQgc3RyaW5ncwogICAgcmV0ID0gbGlzdC5oZWFkLmRhdGEuc2xpY2UoMCwgbik7CiAgICBsaXN0LmhlYWQuZGF0YSA9IGxpc3QuaGVhZC5kYXRhLnNsaWNlKG4pOwogIH0gZWxzZSBpZiAobiA9PT0gbGlzdC5oZWFkLmRhdGEubGVuZ3RoKSB7CiAgICAvLyBmaXJzdCBjaHVuayBpcyBhIHBlcmZlY3QgbWF0Y2gKICAgIHJldCA9IGxpc3Quc2hpZnQoKTsKICB9IGVsc2UgewogICAgLy8gcmVzdWx0IHNwYW5zIG1vcmUgdGhhbiBvbmUgYnVmZmVyCiAgICByZXQgPSBoYXNTdHJpbmdzID8gY29weUZyb21CdWZmZXJTdHJpbmcobiwgbGlzdCkgOiBjb3B5RnJvbUJ1ZmZlcihuLCBsaXN0KTsKICB9CgogIHJldHVybiByZXQ7Cn0gLy8gQ29waWVzIGEgc3BlY2lmaWVkIGFtb3VudCBvZiBjaGFyYWN0ZXJzIGZyb20gdGhlIGxpc3Qgb2YgYnVmZmVyZWQgZGF0YQovLyBjaHVua3MuCi8vIFRoaXMgZnVuY3Rpb24gaXMgZGVzaWduZWQgdG8gYmUgaW5saW5hYmxlLCBzbyBwbGVhc2UgdGFrZSBjYXJlIHdoZW4gbWFraW5nCi8vIGNoYW5nZXMgdG8gdGhlIGZ1bmN0aW9uIGJvZHkuCgoKZnVuY3Rpb24gY29weUZyb21CdWZmZXJTdHJpbmcobiwgbGlzdCkgewogIHZhciBwID0gbGlzdC5oZWFkOwogIHZhciBjID0gMTsKICB2YXIgcmV0ID0gcC5kYXRhOwogIG4gLT0gcmV0Lmxlbmd0aDsKCiAgd2hpbGUgKHAgPSBwLm5leHQpIHsKICAgIHZhciBzdHIgPSBwLmRhdGE7CiAgICB2YXIgbmIgPSBuID4gc3RyLmxlbmd0aCA/IHN0ci5sZW5ndGggOiBuOwogICAgaWYgKG5iID09PSBzdHIubGVuZ3RoKSByZXQgKz0gc3RyO2Vsc2UgcmV0ICs9IHN0ci5zbGljZSgwLCBuKTsKICAgIG4gLT0gbmI7CgogICAgaWYgKG4gPT09IDApIHsKICAgICAgaWYgKG5iID09PSBzdHIubGVuZ3RoKSB7CiAgICAgICAgKytjOwogICAgICAgIGlmIChwLm5leHQpIGxpc3QuaGVhZCA9IHAubmV4dDtlbHNlIGxpc3QuaGVhZCA9IGxpc3QudGFpbCA9IG51bGw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbGlzdC5oZWFkID0gcDsKICAgICAgICBwLmRhdGEgPSBzdHIuc2xpY2UobmIpOwogICAgICB9CgogICAgICBicmVhazsKICAgIH0KCiAgICArK2M7CiAgfQoKICBsaXN0Lmxlbmd0aCAtPSBjOwogIHJldHVybiByZXQ7Cn0gLy8gQ29waWVzIGEgc3BlY2lmaWVkIGFtb3VudCBvZiBieXRlcyBmcm9tIHRoZSBsaXN0IG9mIGJ1ZmZlcmVkIGRhdGEgY2h1bmtzLgovLyBUaGlzIGZ1bmN0aW9uIGlzIGRlc2lnbmVkIHRvIGJlIGlubGluYWJsZSwgc28gcGxlYXNlIHRha2UgY2FyZSB3aGVuIG1ha2luZwovLyBjaGFuZ2VzIHRvIHRoZSBmdW5jdGlvbiBib2R5LgoKCmZ1bmN0aW9uIGNvcHlGcm9tQnVmZmVyKG4sIGxpc3QpIHsKICB2YXIgcmV0ID0gQnVmZmVyLmFsbG9jVW5zYWZlKG4pOwogIHZhciBwID0gbGlzdC5oZWFkOwogIHZhciBjID0gMTsKICBwLmRhdGEuY29weShyZXQpOwogIG4gLT0gcC5kYXRhLmxlbmd0aDsKCiAgd2hpbGUgKHAgPSBwLm5leHQpIHsKICAgIHZhciBidWYgPSBwLmRhdGE7CiAgICB2YXIgbmIgPSBuID4gYnVmLmxlbmd0aCA/IGJ1Zi5sZW5ndGggOiBuOwogICAgYnVmLmNvcHkocmV0LCByZXQubGVuZ3RoIC0gbiwgMCwgbmIpOwogICAgbiAtPSBuYjsKCiAgICBpZiAobiA9PT0gMCkgewogICAgICBpZiAobmIgPT09IGJ1Zi5sZW5ndGgpIHsKICAgICAgICArK2M7CiAgICAgICAgaWYgKHAubmV4dCkgbGlzdC5oZWFkID0gcC5uZXh0O2Vsc2UgbGlzdC5oZWFkID0gbGlzdC50YWlsID0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICBsaXN0LmhlYWQgPSBwOwogICAgICAgIHAuZGF0YSA9IGJ1Zi5zbGljZShuYik7CiAgICAgIH0KCiAgICAgIGJyZWFrOwogICAgfQoKICAgICsrYzsKICB9CgogIGxpc3QubGVuZ3RoIC09IGM7CiAgcmV0dXJuIHJldDsKfQoKZnVuY3Rpb24gZW5kUmVhZGFibGUoc3RyZWFtKSB7CiAgdmFyIHN0YXRlID0gc3RyZWFtLl9yZWFkYWJsZVN0YXRlOyAvLyBJZiB3ZSBnZXQgaGVyZSBiZWZvcmUgY29uc3VtaW5nIGFsbCB0aGUgYnl0ZXMsIHRoZW4gdGhhdCBpcyBhCiAgLy8gYnVnIGluIG5vZGUuICBTaG91bGQgbmV2ZXIgaGFwcGVuLgoKICBpZiAoc3RhdGUubGVuZ3RoID4gMCkgdGhyb3cgbmV3IEVycm9yKCciZW5kUmVhZGFibGUoKSIgY2FsbGVkIG9uIG5vbi1lbXB0eSBzdHJlYW0nKTsKCiAgaWYgKCFzdGF0ZS5lbmRFbWl0dGVkKSB7CiAgICBzdGF0ZS5lbmRlZCA9IHRydWU7CiAgICBwbmEubmV4dFRpY2soZW5kUmVhZGFibGVOVCwgc3RhdGUsIHN0cmVhbSk7CiAgfQp9CgpmdW5jdGlvbiBlbmRSZWFkYWJsZU5UKHN0YXRlLCBzdHJlYW0pIHsKICAvLyBDaGVjayB0aGF0IHdlIGRpZG4ndCBnZXQgb25lIGxhc3QgdW5zaGlmdC4KICBpZiAoIXN0YXRlLmVuZEVtaXR0ZWQgJiYgc3RhdGUubGVuZ3RoID09PSAwKSB7CiAgICBzdGF0ZS5lbmRFbWl0dGVkID0gdHJ1ZTsKICAgIHN0cmVhbS5yZWFkYWJsZSA9IGZhbHNlOwogICAgc3RyZWFtLmVtaXQoJ2VuZCcpOwogIH0KfQoKZnVuY3Rpb24gaW5kZXhPZih4cywgeCkgewogIGZvciAodmFyIGkgPSAwLCBsID0geHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICBpZiAoeHNbaV0gPT09IHgpIHJldHVybiBpOwogIH0KCiAgcmV0dXJuIC0xOwp9"},{"version":3,"sources":["/Users/scott.ward/Documents/GitHub/my-first-bundle/node_modules/readable-stream/lib/_stream_readable.js"],"names":["pna","require","module","exports","Readable","isArray","Duplex","ReadableState","EE","EventEmitter","EElistenerCount","emitter","type","listeners","length","Stream","Buffer","OurUint8Array","global","Uint8Array","_uint8ArrayToBuffer","chunk","from","_isUint8Array","obj","isBuffer","util","Object","create","inherits","debugUtil","debug","debuglog","BufferList","destroyImpl","StringDecoder","kProxyEvents","prependListener","event","fn","_events","on","unshift","options","stream","isDuplex","objectMode","readableObjectMode","hwm","highWaterMark","readableHwm","readableHighWaterMark","defaultHwm","Math","floor","buffer","pipes","pipesCount","flowing","ended","endEmitted","reading","sync","needReadable","emittedReadable","readableListening","resumeScheduled","destroyed","defaultEncoding","awaitDrain","readingMore","decoder","encoding","_readableState","readable","read","_read","destroy","_destroy","call","defineProperty","prototype","get","undefined","set","value","_undestroy","undestroy","err","cb","push","state","skipChunkCheck","readableAddChunk","addToFront","onEofChunk","er","chunkInvalid","emit","getPrototypeOf","Error","addChunk","write","maybeReadMore","needMoreData","emitReadable","TypeError","isPaused","setEncoding","enc","MAX_HWM","computeNewHighWaterMark","n","howMuchToRead","head","data","parseInt","nOrig","endReadable","doRead","ret","fromList","end","nextTick","emitReadable_","flow","maybeReadMore_","len","pipe","dest","pipeOpts","src","doEnd","process","stdout","stderr","endFn","onend","unpipe","once","onunpipe","unpipeInfo","hasUnpiped","cleanup","ondrain","pipeOnDrain","cleanedUp","removeListener","onclose","onfinish","onerror","ondata","_writableState","needDrain","increasedAwaitDrain","indexOf","pause","resume","dests","i","index","splice","ev","res","nReadingNextTick","addListener","self","resume_","wrap","_this","paused","method","apply","arguments","bind","enumerable","_fromList","shift","join","concat","clear","fromListPartial","list","hasStrings","slice","copyFromBufferString","copyFromBuffer","p","c","next","str","nb","tail","allocUnsafe","copy","buf","endReadableNT","xs","x","l"],"mappings":"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","sourcesContent":["// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\n/*<replacement>*/\n\nvar pna = require('process-nextick-args');\n/*</replacement>*/\n\nmodule.exports = Readable;\n\n/*<replacement>*/\nvar isArray = require('isarray');\n/*</replacement>*/\n\n/*<replacement>*/\nvar Duplex;\n/*</replacement>*/\n\nReadable.ReadableState = ReadableState;\n\n/*<replacement>*/\nvar EE = require('events').EventEmitter;\n\nvar EElistenerCount = function (emitter, type) {\n  return emitter.listeners(type).length;\n};\n/*</replacement>*/\n\n/*<replacement>*/\nvar Stream = require('./internal/streams/stream');\n/*</replacement>*/\n\n/*<replacement>*/\n\nvar Buffer = require('safe-buffer').Buffer;\nvar OurUint8Array = global.Uint8Array || function () {};\nfunction _uint8ArrayToBuffer(chunk) {\n  return Buffer.from(chunk);\n}\nfunction _isUint8Array(obj) {\n  return Buffer.isBuffer(obj) || obj instanceof OurUint8Array;\n}\n\n/*</replacement>*/\n\n/*<replacement>*/\nvar util = Object.create(require('core-util-is'));\nutil.inherits = require('inherits');\n/*</replacement>*/\n\n/*<replacement>*/\nvar debugUtil = require('util');\nvar debug = void 0;\nif (debugUtil && debugUtil.debuglog) {\n  debug = debugUtil.debuglog('stream');\n} else {\n  debug = function () {};\n}\n/*</replacement>*/\n\nvar BufferList = require('./internal/streams/BufferList');\nvar destroyImpl = require('./internal/streams/destroy');\nvar StringDecoder;\n\nutil.inherits(Readable, Stream);\n\nvar kProxyEvents = ['error', 'close', 'destroy', 'pause', 'resume'];\n\nfunction prependListener(emitter, event, fn) {\n  // Sadly this is not cacheable as some libraries bundle their own\n  // event emitter implementation with them.\n  if (typeof emitter.prependListener === 'function') return emitter.prependListener(event, fn);\n\n  // This is a hack to make sure that our error handler is attached before any\n  // userland ones.  NEVER DO THIS. This is here only because this code needs\n  // to continue to work with older versions of Node.js that do not include\n  // the prependListener() method. The goal is to eventually remove this hack.\n  if (!emitter._events || !emitter._events[event]) emitter.on(event, fn);else if (isArray(emitter._events[event])) emitter._events[event].unshift(fn);else emitter._events[event] = [fn, emitter._events[event]];\n}\n\nfunction ReadableState(options, stream) {\n  Duplex = Duplex || require('./_stream_duplex');\n\n  options = options || {};\n\n  // Duplex streams are both readable and writable, but share\n  // the same options object.\n  // However, some cases require setting options to different\n  // values for the readable and the writable sides of the duplex stream.\n  // These options can be provided separately as readableXXX and writableXXX.\n  var isDuplex = stream instanceof Duplex;\n\n  // object stream flag. Used to make read(n) ignore n and to\n  // make all the buffer merging and length checks go away\n  this.objectMode = !!options.objectMode;\n\n  if (isDuplex) this.objectMode = this.objectMode || !!options.readableObjectMode;\n\n  // the point at which it stops calling _read() to fill the buffer\n  // Note: 0 is a valid value, means \"don't call _read preemptively ever\"\n  var hwm = options.highWaterMark;\n  var readableHwm = options.readableHighWaterMark;\n  var defaultHwm = this.objectMode ? 16 : 16 * 1024;\n\n  if (hwm || hwm === 0) this.highWaterMark = hwm;else if (isDuplex && (readableHwm || readableHwm === 0)) this.highWaterMark = readableHwm;else this.highWaterMark = defaultHwm;\n\n  // cast to ints.\n  this.highWaterMark = Math.floor(this.highWaterMark);\n\n  // A linked list is used to store data chunks instead of an array because the\n  // linked list can remove elements from the beginning faster than\n  // array.shift()\n  this.buffer = new BufferList();\n  this.length = 0;\n  this.pipes = null;\n  this.pipesCount = 0;\n  this.flowing = null;\n  this.ended = false;\n  this.endEmitted = false;\n  this.reading = false;\n\n  // a flag to be able to tell if the event 'readable'/'data' is emitted\n  // immediately, or on a later tick.  We set this to true at first, because\n  // any actions that shouldn't happen until \"later\" should generally also\n  // not happen before the first read call.\n  this.sync = true;\n\n  // whenever we return null, then we set a flag to say\n  // that we're awaiting a 'readable' event emission.\n  this.needReadable = false;\n  this.emittedReadable = false;\n  this.readableListening = false;\n  this.resumeScheduled = false;\n\n  // has it been destroyed\n  this.destroyed = false;\n\n  // Crypto is kind of old and crusty.  Historically, its default string\n  // encoding is 'binary' so we have to make this configurable.\n  // Everything else in the universe uses 'utf8', though.\n  this.defaultEncoding = options.defaultEncoding || 'utf8';\n\n  // the number of writers that are awaiting a drain event in .pipe()s\n  this.awaitDrain = 0;\n\n  // if true, a maybeReadMore has been scheduled\n  this.readingMore = false;\n\n  this.decoder = null;\n  this.encoding = null;\n  if (options.encoding) {\n    if (!StringDecoder) StringDecoder = require('string_decoder/').StringDecoder;\n    this.decoder = new StringDecoder(options.encoding);\n    this.encoding = options.encoding;\n  }\n}\n\nfunction Readable(options) {\n  Duplex = Duplex || require('./_stream_duplex');\n\n  if (!(this instanceof Readable)) return new Readable(options);\n\n  this._readableState = new ReadableState(options, this);\n\n  // legacy\n  this.readable = true;\n\n  if (options) {\n    if (typeof options.read === 'function') this._read = options.read;\n\n    if (typeof options.destroy === 'function') this._destroy = options.destroy;\n  }\n\n  Stream.call(this);\n}\n\nObject.defineProperty(Readable.prototype, 'destroyed', {\n  get: function () {\n    if (this._readableState === undefined) {\n      return false;\n    }\n    return this._readableState.destroyed;\n  },\n  set: function (value) {\n    // we ignore the value if the stream\n    // has not been initialized yet\n    if (!this._readableState) {\n      return;\n    }\n\n    // backward compatibility, the user is explicitly\n    // managing destroyed\n    this._readableState.destroyed = value;\n  }\n});\n\nReadable.prototype.destroy = destroyImpl.destroy;\nReadable.prototype._undestroy = destroyImpl.undestroy;\nReadable.prototype._destroy = function (err, cb) {\n  this.push(null);\n  cb(err);\n};\n\n// Manually shove something into the read() buffer.\n// This returns true if the highWaterMark has not been hit yet,\n// similar to how Writable.write() returns true if you should\n// write() some more.\nReadable.prototype.push = function (chunk, encoding) {\n  var state = this._readableState;\n  var skipChunkCheck;\n\n  if (!state.objectMode) {\n    if (typeof chunk === 'string') {\n      encoding = encoding || state.defaultEncoding;\n      if (encoding !== state.encoding) {\n        chunk = Buffer.from(chunk, encoding);\n        encoding = '';\n      }\n      skipChunkCheck = true;\n    }\n  } else {\n    skipChunkCheck = true;\n  }\n\n  return readableAddChunk(this, chunk, encoding, false, skipChunkCheck);\n};\n\n// Unshift should *always* be something directly out of read()\nReadable.prototype.unshift = function (chunk) {\n  return readableAddChunk(this, chunk, null, true, false);\n};\n\nfunction readableAddChunk(stream, chunk, encoding, addToFront, skipChunkCheck) {\n  var state = stream._readableState;\n  if (chunk === null) {\n    state.reading = false;\n    onEofChunk(stream, state);\n  } else {\n    var er;\n    if (!skipChunkCheck) er = chunkInvalid(state, chunk);\n    if (er) {\n      stream.emit('error', er);\n    } else if (state.objectMode || chunk && chunk.length > 0) {\n      if (typeof chunk !== 'string' && !state.objectMode && Object.getPrototypeOf(chunk) !== Buffer.prototype) {\n        chunk = _uint8ArrayToBuffer(chunk);\n      }\n\n      if (addToFront) {\n        if (state.endEmitted) stream.emit('error', new Error('stream.unshift() after end event'));else addChunk(stream, state, chunk, true);\n      } else if (state.ended) {\n        stream.emit('error', new Error('stream.push() after EOF'));\n      } else {\n        state.reading = false;\n        if (state.decoder && !encoding) {\n          chunk = state.decoder.write(chunk);\n          if (state.objectMode || chunk.length !== 0) addChunk(stream, state, chunk, false);else maybeReadMore(stream, state);\n        } else {\n          addChunk(stream, state, chunk, false);\n        }\n      }\n    } else if (!addToFront) {\n      state.reading = false;\n    }\n  }\n\n  return needMoreData(state);\n}\n\nfunction addChunk(stream, state, chunk, addToFront) {\n  if (state.flowing && state.length === 0 && !state.sync) {\n    stream.emit('data', chunk);\n    stream.read(0);\n  } else {\n    // update the buffer info.\n    state.length += state.objectMode ? 1 : chunk.length;\n    if (addToFront) state.buffer.unshift(chunk);else state.buffer.push(chunk);\n\n    if (state.needReadable) emitReadable(stream);\n  }\n  maybeReadMore(stream, state);\n}\n\nfunction chunkInvalid(state, chunk) {\n  var er;\n  if (!_isUint8Array(chunk) && typeof chunk !== 'string' && chunk !== undefined && !state.objectMode) {\n    er = new TypeError('Invalid non-string/buffer chunk');\n  }\n  return er;\n}\n\n// if it's past the high water mark, we can push in some more.\n// Also, if we have no data yet, we can stand some\n// more bytes.  This is to work around cases where hwm=0,\n// such as the repl.  Also, if the push() triggered a\n// readable event, and the user called read(largeNumber) such that\n// needReadable was set, then we ought to push more, so that another\n// 'readable' event will be triggered.\nfunction needMoreData(state) {\n  return !state.ended && (state.needReadable || state.length < state.highWaterMark || state.length === 0);\n}\n\nReadable.prototype.isPaused = function () {\n  return this._readableState.flowing === false;\n};\n\n// backwards compatibility.\nReadable.prototype.setEncoding = function (enc) {\n  if (!StringDecoder) StringDecoder = require('string_decoder/').StringDecoder;\n  this._readableState.decoder = new StringDecoder(enc);\n  this._readableState.encoding = enc;\n  return this;\n};\n\n// Don't raise the hwm > 8MB\nvar MAX_HWM = 0x800000;\nfunction computeNewHighWaterMark(n) {\n  if (n >= MAX_HWM) {\n    n = MAX_HWM;\n  } else {\n    // Get the next highest power of 2 to prevent increasing hwm excessively in\n    // tiny amounts\n    n--;\n    n |= n >>> 1;\n    n |= n >>> 2;\n    n |= n >>> 4;\n    n |= n >>> 8;\n    n |= n >>> 16;\n    n++;\n  }\n  return n;\n}\n\n// This function is designed to be inlinable, so please take care when making\n// changes to the function body.\nfunction howMuchToRead(n, state) {\n  if (n <= 0 || state.length === 0 && state.ended) return 0;\n  if (state.objectMode) return 1;\n  if (n !== n) {\n    // Only flow one buffer at a time\n    if (state.flowing && state.length) return state.buffer.head.data.length;else return state.length;\n  }\n  // If we're asking for more than the current hwm, then raise the hwm.\n  if (n > state.highWaterMark) state.highWaterMark = computeNewHighWaterMark(n);\n  if (n <= state.length) return n;\n  // Don't have enough\n  if (!state.ended) {\n    state.needReadable = true;\n    return 0;\n  }\n  return state.length;\n}\n\n// you can override either this method, or the async _read(n) below.\nReadable.prototype.read = function (n) {\n  debug('read', n);\n  n = parseInt(n, 10);\n  var state = this._readableState;\n  var nOrig = n;\n\n  if (n !== 0) state.emittedReadable = false;\n\n  // if we're doing read(0) to trigger a readable event, but we\n  // already have a bunch of data in the buffer, then just trigger\n  // the 'readable' event and move on.\n  if (n === 0 && state.needReadable && (state.length >= state.highWaterMark || state.ended)) {\n    debug('read: emitReadable', state.length, state.ended);\n    if (state.length === 0 && state.ended) endReadable(this);else emitReadable(this);\n    return null;\n  }\n\n  n = howMuchToRead(n, state);\n\n  // if we've ended, and we're now clear, then finish it up.\n  if (n === 0 && state.ended) {\n    if (state.length === 0) endReadable(this);\n    return null;\n  }\n\n  // All the actual chunk generation logic needs to be\n  // *below* the call to _read.  The reason is that in certain\n  // synthetic stream cases, such as passthrough streams, _read\n  // may be a completely synchronous operation which may change\n  // the state of the read buffer, providing enough data when\n  // before there was *not* enough.\n  //\n  // So, the steps are:\n  // 1. Figure out what the state of things will be after we do\n  // a read from the buffer.\n  //\n  // 2. If that resulting state will trigger a _read, then call _read.\n  // Note that this may be asynchronous, or synchronous.  Yes, it is\n  // deeply ugly to write APIs this way, but that still doesn't mean\n  // that the Readable class should behave improperly, as streams are\n  // designed to be sync/async agnostic.\n  // Take note if the _read call is sync or async (ie, if the read call\n  // has returned yet), so that we know whether or not it's safe to emit\n  // 'readable' etc.\n  //\n  // 3. Actually pull the requested chunks out of the buffer and return.\n\n  // if we need a readable event, then we need to do some reading.\n  var doRead = state.needReadable;\n  debug('need readable', doRead);\n\n  // if we currently have less than the highWaterMark, then also read some\n  if (state.length === 0 || state.length - n < state.highWaterMark) {\n    doRead = true;\n    debug('length less than watermark', doRead);\n  }\n\n  // however, if we've ended, then there's no point, and if we're already\n  // reading, then it's unnecessary.\n  if (state.ended || state.reading) {\n    doRead = false;\n    debug('reading or ended', doRead);\n  } else if (doRead) {\n    debug('do read');\n    state.reading = true;\n    state.sync = true;\n    // if the length is currently zero, then we *need* a readable event.\n    if (state.length === 0) state.needReadable = true;\n    // call internal read method\n    this._read(state.highWaterMark);\n    state.sync = false;\n    // If _read pushed data synchronously, then `reading` will be false,\n    // and we need to re-evaluate how much data we can return to the user.\n    if (!state.reading) n = howMuchToRead(nOrig, state);\n  }\n\n  var ret;\n  if (n > 0) ret = fromList(n, state);else ret = null;\n\n  if (ret === null) {\n    state.needReadable = true;\n    n = 0;\n  } else {\n    state.length -= n;\n  }\n\n  if (state.length === 0) {\n    // If we have nothing in the buffer, then we want to know\n    // as soon as we *do* get something into the buffer.\n    if (!state.ended) state.needReadable = true;\n\n    // If we tried to read() past the EOF, then emit end on the next tick.\n    if (nOrig !== n && state.ended) endReadable(this);\n  }\n\n  if (ret !== null) this.emit('data', ret);\n\n  return ret;\n};\n\nfunction onEofChunk(stream, state) {\n  if (state.ended) return;\n  if (state.decoder) {\n    var chunk = state.decoder.end();\n    if (chunk && chunk.length) {\n      state.buffer.push(chunk);\n      state.length += state.objectMode ? 1 : chunk.length;\n    }\n  }\n  state.ended = true;\n\n  // emit 'readable' now to make sure it gets picked up.\n  emitReadable(stream);\n}\n\n// Don't emit readable right away in sync mode, because this can trigger\n// another read() call => stack overflow.  This way, it might trigger\n// a nextTick recursion warning, but that's not so bad.\nfunction emitReadable(stream) {\n  var state = stream._readableState;\n  state.needReadable = false;\n  if (!state.emittedReadable) {\n    debug('emitReadable', state.flowing);\n    state.emittedReadable = true;\n    if (state.sync) pna.nextTick(emitReadable_, stream);else emitReadable_(stream);\n  }\n}\n\nfunction emitReadable_(stream) {\n  debug('emit readable');\n  stream.emit('readable');\n  flow(stream);\n}\n\n// at this point, the user has presumably seen the 'readable' event,\n// and called read() to consume some data.  that may have triggered\n// in turn another _read(n) call, in which case reading = true if\n// it's in progress.\n// However, if we're not ended, or reading, and the length < hwm,\n// then go ahead and try to read some more preemptively.\nfunction maybeReadMore(stream, state) {\n  if (!state.readingMore) {\n    state.readingMore = true;\n    pna.nextTick(maybeReadMore_, stream, state);\n  }\n}\n\nfunction maybeReadMore_(stream, state) {\n  var len = state.length;\n  while (!state.reading && !state.flowing && !state.ended && state.length < state.highWaterMark) {\n    debug('maybeReadMore read 0');\n    stream.read(0);\n    if (len === state.length)\n      // didn't get any data, stop spinning.\n      break;else len = state.length;\n  }\n  state.readingMore = false;\n}\n\n// abstract method.  to be overridden in specific implementation classes.\n// call cb(er, data) where data is <= n in length.\n// for virtual (non-string, non-buffer) streams, \"length\" is somewhat\n// arbitrary, and perhaps not very meaningful.\nReadable.prototype._read = function (n) {\n  this.emit('error', new Error('_read() is not implemented'));\n};\n\nReadable.prototype.pipe = function (dest, pipeOpts) {\n  var src = this;\n  var state = this._readableState;\n\n  switch (state.pipesCount) {\n    case 0:\n      state.pipes = dest;\n      break;\n    case 1:\n      state.pipes = [state.pipes, dest];\n      break;\n    default:\n      state.pipes.push(dest);\n      break;\n  }\n  state.pipesCount += 1;\n  debug('pipe count=%d opts=%j', state.pipesCount, pipeOpts);\n\n  var doEnd = (!pipeOpts || pipeOpts.end !== false) && dest !== process.stdout && dest !== process.stderr;\n\n  var endFn = doEnd ? onend : unpipe;\n  if (state.endEmitted) pna.nextTick(endFn);else src.once('end', endFn);\n\n  dest.on('unpipe', onunpipe);\n  function onunpipe(readable, unpipeInfo) {\n    debug('onunpipe');\n    if (readable === src) {\n      if (unpipeInfo && unpipeInfo.hasUnpiped === false) {\n        unpipeInfo.hasUnpiped = true;\n        cleanup();\n      }\n    }\n  }\n\n  function onend() {\n    debug('onend');\n    dest.end();\n  }\n\n  // when the dest drains, it reduces the awaitDrain counter\n  // on the source.  This would be more elegant with a .once()\n  // handler in flow(), but adding and removing repeatedly is\n  // too slow.\n  var ondrain = pipeOnDrain(src);\n  dest.on('drain', ondrain);\n\n  var cleanedUp = false;\n  function cleanup() {\n    debug('cleanup');\n    // cleanup event handlers once the pipe is broken\n    dest.removeListener('close', onclose);\n    dest.removeListener('finish', onfinish);\n    dest.removeListener('drain', ondrain);\n    dest.removeListener('error', onerror);\n    dest.removeListener('unpipe', onunpipe);\n    src.removeListener('end', onend);\n    src.removeListener('end', unpipe);\n    src.removeListener('data', ondata);\n\n    cleanedUp = true;\n\n    // if the reader is waiting for a drain event from this\n    // specific writer, then it would cause it to never start\n    // flowing again.\n    // So, if this is awaiting a drain, then we just call it now.\n    // If we don't know, then assume that we are waiting for one.\n    if (state.awaitDrain && (!dest._writableState || dest._writableState.needDrain)) ondrain();\n  }\n\n  // If the user pushes more data while we're writing to dest then we'll end up\n  // in ondata again. However, we only want to increase awaitDrain once because\n  // dest will only emit one 'drain' event for the multiple writes.\n  // => Introduce a guard on increasing awaitDrain.\n  var increasedAwaitDrain = false;\n  src.on('data', ondata);\n  function ondata(chunk) {\n    debug('ondata');\n    increasedAwaitDrain = false;\n    var ret = dest.write(chunk);\n    if (false === ret && !increasedAwaitDrain) {\n      // If the user unpiped during `dest.write()`, it is possible\n      // to get stuck in a permanently paused state if that write\n      // also returned false.\n      // => Check whether `dest` is still a piping destination.\n      if ((state.pipesCount === 1 && state.pipes === dest || state.pipesCount > 1 && indexOf(state.pipes, dest) !== -1) && !cleanedUp) {\n        debug('false write response, pause', src._readableState.awaitDrain);\n        src._readableState.awaitDrain++;\n        increasedAwaitDrain = true;\n      }\n      src.pause();\n    }\n  }\n\n  // if the dest has an error, then stop piping into it.\n  // however, don't suppress the throwing behavior for this.\n  function onerror(er) {\n    debug('onerror', er);\n    unpipe();\n    dest.removeListener('error', onerror);\n    if (EElistenerCount(dest, 'error') === 0) dest.emit('error', er);\n  }\n\n  // Make sure our error handler is attached before userland ones.\n  prependListener(dest, 'error', onerror);\n\n  // Both close and finish should trigger unpipe, but only once.\n  function onclose() {\n    dest.removeListener('finish', onfinish);\n    unpipe();\n  }\n  dest.once('close', onclose);\n  function onfinish() {\n    debug('onfinish');\n    dest.removeListener('close', onclose);\n    unpipe();\n  }\n  dest.once('finish', onfinish);\n\n  function unpipe() {\n    debug('unpipe');\n    src.unpipe(dest);\n  }\n\n  // tell the dest that it's being piped to\n  dest.emit('pipe', src);\n\n  // start the flow if it hasn't been started already.\n  if (!state.flowing) {\n    debug('pipe resume');\n    src.resume();\n  }\n\n  return dest;\n};\n\nfunction pipeOnDrain(src) {\n  return function () {\n    var state = src._readableState;\n    debug('pipeOnDrain', state.awaitDrain);\n    if (state.awaitDrain) state.awaitDrain--;\n    if (state.awaitDrain === 0 && EElistenerCount(src, 'data')) {\n      state.flowing = true;\n      flow(src);\n    }\n  };\n}\n\nReadable.prototype.unpipe = function (dest) {\n  var state = this._readableState;\n  var unpipeInfo = { hasUnpiped: false };\n\n  // if we're not piping anywhere, then do nothing.\n  if (state.pipesCount === 0) return this;\n\n  // just one destination.  most common case.\n  if (state.pipesCount === 1) {\n    // passed in one, but it's not the right one.\n    if (dest && dest !== state.pipes) return this;\n\n    if (!dest) dest = state.pipes;\n\n    // got a match.\n    state.pipes = null;\n    state.pipesCount = 0;\n    state.flowing = false;\n    if (dest) dest.emit('unpipe', this, unpipeInfo);\n    return this;\n  }\n\n  // slow case. multiple pipe destinations.\n\n  if (!dest) {\n    // remove all.\n    var dests = state.pipes;\n    var len = state.pipesCount;\n    state.pipes = null;\n    state.pipesCount = 0;\n    state.flowing = false;\n\n    for (var i = 0; i < len; i++) {\n      dests[i].emit('unpipe', this, unpipeInfo);\n    }return this;\n  }\n\n  // try to find the right one.\n  var index = indexOf(state.pipes, dest);\n  if (index === -1) return this;\n\n  state.pipes.splice(index, 1);\n  state.pipesCount -= 1;\n  if (state.pipesCount === 1) state.pipes = state.pipes[0];\n\n  dest.emit('unpipe', this, unpipeInfo);\n\n  return this;\n};\n\n// set up data events if they are asked for\n// Ensure readable listeners eventually get something\nReadable.prototype.on = function (ev, fn) {\n  var res = Stream.prototype.on.call(this, ev, fn);\n\n  if (ev === 'data') {\n    // Start flowing on next tick if stream isn't explicitly paused\n    if (this._readableState.flowing !== false) this.resume();\n  } else if (ev === 'readable') {\n    var state = this._readableState;\n    if (!state.endEmitted && !state.readableListening) {\n      state.readableListening = state.needReadable = true;\n      state.emittedReadable = false;\n      if (!state.reading) {\n        pna.nextTick(nReadingNextTick, this);\n      } else if (state.length) {\n        emitReadable(this);\n      }\n    }\n  }\n\n  return res;\n};\nReadable.prototype.addListener = Readable.prototype.on;\n\nfunction nReadingNextTick(self) {\n  debug('readable nexttick read 0');\n  self.read(0);\n}\n\n// pause() and resume() are remnants of the legacy readable stream API\n// If the user uses them, then switch into old mode.\nReadable.prototype.resume = function () {\n  var state = this._readableState;\n  if (!state.flowing) {\n    debug('resume');\n    state.flowing = true;\n    resume(this, state);\n  }\n  return this;\n};\n\nfunction resume(stream, state) {\n  if (!state.resumeScheduled) {\n    state.resumeScheduled = true;\n    pna.nextTick(resume_, stream, state);\n  }\n}\n\nfunction resume_(stream, state) {\n  if (!state.reading) {\n    debug('resume read 0');\n    stream.read(0);\n  }\n\n  state.resumeScheduled = false;\n  state.awaitDrain = 0;\n  stream.emit('resume');\n  flow(stream);\n  if (state.flowing && !state.reading) stream.read(0);\n}\n\nReadable.prototype.pause = function () {\n  debug('call pause flowing=%j', this._readableState.flowing);\n  if (false !== this._readableState.flowing) {\n    debug('pause');\n    this._readableState.flowing = false;\n    this.emit('pause');\n  }\n  return this;\n};\n\nfunction flow(stream) {\n  var state = stream._readableState;\n  debug('flow', state.flowing);\n  while (state.flowing && stream.read() !== null) {}\n}\n\n// wrap an old-style stream as the async data source.\n// This is *not* part of the readable stream interface.\n// It is an ugly unfortunate mess of history.\nReadable.prototype.wrap = function (stream) {\n  var _this = this;\n\n  var state = this._readableState;\n  var paused = false;\n\n  stream.on('end', function () {\n    debug('wrapped end');\n    if (state.decoder && !state.ended) {\n      var chunk = state.decoder.end();\n      if (chunk && chunk.length) _this.push(chunk);\n    }\n\n    _this.push(null);\n  });\n\n  stream.on('data', function (chunk) {\n    debug('wrapped data');\n    if (state.decoder) chunk = state.decoder.write(chunk);\n\n    // don't skip over falsy values in objectMode\n    if (state.objectMode && (chunk === null || chunk === undefined)) return;else if (!state.objectMode && (!chunk || !chunk.length)) return;\n\n    var ret = _this.push(chunk);\n    if (!ret) {\n      paused = true;\n      stream.pause();\n    }\n  });\n\n  // proxy all the other methods.\n  // important when wrapping filters and duplexes.\n  for (var i in stream) {\n    if (this[i] === undefined && typeof stream[i] === 'function') {\n      this[i] = function (method) {\n        return function () {\n          return stream[method].apply(stream, arguments);\n        };\n      }(i);\n    }\n  }\n\n  // proxy certain important events.\n  for (var n = 0; n < kProxyEvents.length; n++) {\n    stream.on(kProxyEvents[n], this.emit.bind(this, kProxyEvents[n]));\n  }\n\n  // when we try to consume some more bytes, simply unpause the\n  // underlying stream.\n  this._read = function (n) {\n    debug('wrapped _read', n);\n    if (paused) {\n      paused = false;\n      stream.resume();\n    }\n  };\n\n  return this;\n};\n\nObject.defineProperty(Readable.prototype, 'readableHighWaterMark', {\n  // making it explicit this property is not enumerable\n  // because otherwise some prototype manipulation in\n  // userland will fail\n  enumerable: false,\n  get: function () {\n    return this._readableState.highWaterMark;\n  }\n});\n\n// exposed for testing purposes only.\nReadable._fromList = fromList;\n\n// Pluck off n bytes from an array of buffers.\n// Length is the combined lengths of all the buffers in the list.\n// This function is designed to be inlinable, so please take care when making\n// changes to the function body.\nfunction fromList(n, state) {\n  // nothing buffered\n  if (state.length === 0) return null;\n\n  var ret;\n  if (state.objectMode) ret = state.buffer.shift();else if (!n || n >= state.length) {\n    // read it all, truncate the list\n    if (state.decoder) ret = state.buffer.join('');else if (state.buffer.length === 1) ret = state.buffer.head.data;else ret = state.buffer.concat(state.length);\n    state.buffer.clear();\n  } else {\n    // read part of list\n    ret = fromListPartial(n, state.buffer, state.decoder);\n  }\n\n  return ret;\n}\n\n// Extracts only enough buffered data to satisfy the amount requested.\n// This function is designed to be inlinable, so please take care when making\n// changes to the function body.\nfunction fromListPartial(n, list, hasStrings) {\n  var ret;\n  if (n < list.head.data.length) {\n    // slice is the same for buffers and strings\n    ret = list.head.data.slice(0, n);\n    list.head.data = list.head.data.slice(n);\n  } else if (n === list.head.data.length) {\n    // first chunk is a perfect match\n    ret = list.shift();\n  } else {\n    // result spans more than one buffer\n    ret = hasStrings ? copyFromBufferString(n, list) : copyFromBuffer(n, list);\n  }\n  return ret;\n}\n\n// Copies a specified amount of characters from the list of buffered data\n// chunks.\n// This function is designed to be inlinable, so please take care when making\n// changes to the function body.\nfunction copyFromBufferString(n, list) {\n  var p = list.head;\n  var c = 1;\n  var ret = p.data;\n  n -= ret.length;\n  while (p = p.next) {\n    var str = p.data;\n    var nb = n > str.length ? str.length : n;\n    if (nb === str.length) ret += str;else ret += str.slice(0, n);\n    n -= nb;\n    if (n === 0) {\n      if (nb === str.length) {\n        ++c;\n        if (p.next) list.head = p.next;else list.head = list.tail = null;\n      } else {\n        list.head = p;\n        p.data = str.slice(nb);\n      }\n      break;\n    }\n    ++c;\n  }\n  list.length -= c;\n  return ret;\n}\n\n// Copies a specified amount of bytes from the list of buffered data chunks.\n// This function is designed to be inlinable, so please take care when making\n// changes to the function body.\nfunction copyFromBuffer(n, list) {\n  var ret = Buffer.allocUnsafe(n);\n  var p = list.head;\n  var c = 1;\n  p.data.copy(ret);\n  n -= p.data.length;\n  while (p = p.next) {\n    var buf = p.data;\n    var nb = n > buf.length ? buf.length : n;\n    buf.copy(ret, ret.length - n, 0, nb);\n    n -= nb;\n    if (n === 0) {\n      if (nb === buf.length) {\n        ++c;\n        if (p.next) list.head = p.next;else list.head = list.tail = null;\n      } else {\n        list.head = p;\n        p.data = buf.slice(nb);\n      }\n      break;\n    }\n    ++c;\n  }\n  list.length -= c;\n  return ret;\n}\n\nfunction endReadable(stream) {\n  var state = stream._readableState;\n\n  // If we get here before consuming all the bytes, then that is a\n  // bug in node.  Should never happen.\n  if (state.length > 0) throw new Error('\"endReadable()\" called on non-empty stream');\n\n  if (!state.endEmitted) {\n    state.ended = true;\n    pna.nextTick(endReadableNT, state, stream);\n  }\n}\n\nfunction endReadableNT(state, stream) {\n  // Check that we didn't get one last unshift.\n  if (!state.endEmitted && state.length === 0) {\n    state.endEmitted = true;\n    stream.readable = false;\n    stream.emit('end');\n  }\n}\n\nfunction indexOf(xs, x) {\n  for (var i = 0, l = xs.length; i < l; i++) {\n    if (xs[i] === x) return i;\n  }\n  return -1;\n}"]}]}