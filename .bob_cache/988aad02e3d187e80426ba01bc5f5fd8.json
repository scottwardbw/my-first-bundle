{"remainingRequest":"/Users/scott.ward/.npm/_npx/14187/lib/node_modules/@vizia/app-emulator/node_modules/babel-loader/lib/index.js??ref--4-1!/Users/scott.ward/Documents/GitHub/my-first-bundle/node_modules/@vizia/bundle/lib/Bundle.js","dependencies":[{"path":"/Users/scott.ward/Documents/GitHub/my-first-bundle/node_modules/@vizia/bundle/lib/Bundle.js","mtime":499162500000},{"path":"/Users/scott.ward/.npm/_npx/14187/lib/node_modules/@vizia/app-emulator/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/scott.ward/.npm/_npx/14187/lib/node_modules/@vizia/app-emulator/node_modules/babel-loader/lib/index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:J3VzZSBzdHJpY3QnOwoKY29uc3QgRXZlbnRFbWl0dGVyID0gcmVxdWlyZSgnZXZlbnRzJyk7Cgpjb25zdCBmcm9tID0gcmVxdWlyZSgnZnJvbTInKTsKCmNvbnN0IHRocm91Z2ggPSByZXF1aXJlKCd0aHJvdWdoMicpOwoKY29uc3Qgd3JpdGVyID0gcmVxdWlyZSgndG8yJyk7Cgpjb25zdCBwdW1waWZ5ID0gcmVxdWlyZSgncHVtcGlmeScpOwoKY29uc3QgY29uY2F0ID0gcmVxdWlyZSgnY29uY2F0LXN0cmVhbScpOwoKY29uc3Qgc3B5ID0gcmVxdWlyZSgndGhyb3VnaDItc3B5Jyk7Cgpjb25zdCBlb3MgPSByZXF1aXJlKCdlbmQtb2Ytc3RyZWFtJyk7CgpmdW5jdGlvbiBlbnN1cmVFcnJvcihlcnIpIHsKICByZXR1cm4gZXJyIGluc3RhbmNlb2YgRXJyb3IgPyBlcnIgOiBuZXcgRXJyb3IoZXJyLm1lc3NhZ2UgfHwgZXJyKTsKfQoKbW9kdWxlLmV4cG9ydHMgPSBjbGFzcyBCdW5kbGUgZXh0ZW5kcyBFdmVudEVtaXR0ZXIgewogIGNvbnN0cnVjdG9yKCkgewogICAgc3VwZXIoKTsKICAgIHRoaXMuaW5pdGlhbENvbmZpZyA9IHt9OwogICAgdGhpcy5mblNwZWNzID0gW107CiAgICB0aGlzLmxpbWl0ID0gLTE7CiAgICB0aGlzLl9od20gPSAxOyAvLyBoaWdoV2F0ZXJNYXJrIGZvciBzdHJlYW1zLiBEb24ndCBtZXNzIHdpdGggaXQgdW5sZXNzIHlvdSBrbm93IHdoYXQgeW91J3JlIGRvaW5nLgogIH0KCiAgc2V0VGhyb3R0bGUobXMpIHsKICAgIHRoaXMuZ2V0VGhyb3R0bGUgPSAoKSA9PiBtczsKICB9CgogIGdldFRocm90dGxlKCkgewogICAgcmV0dXJuIC0xOwogIH0KCiAgdXNlKG9iaikgewogICAgaWYgKG9iai5zb3VyY2UpIHsKICAgICAgdGhpcy5zb3VyY2VTcGVjID0gb2JqOwogICAgfSBlbHNlIGlmIChvYmoudHJhbnNmb3JtIHx8IG9iai50YXApIHsKICAgICAgdGhpcy5mblNwZWNzLnB1c2gob2JqKTsKICAgIH0gZWxzZSBpZiAob2JqLmRlc3RpbmF0aW9uKSB7CiAgICAgIHRoaXMuZGVzdGluYXRpb25TcGVjID0gb2JqOwogICAgfQogIH0KCiAgYXN5bmMgcHJlY29uZmlnKGNvbmZpZykgewogICAgcmV0dXJuIGNvbmZpZzsKICB9CgogIGFzeW5jIGNvbXB1dGVDb25maWcoaW5pdGlhbENvbmZpZywgY3VycmVudENvbmZpZykgewogICAgcmV0dXJuIGN1cnJlbnRDb25maWc7CiAgfQoKICBhc3luYyBsb2FkKGNvbmZpZykgewogICAgbGV0IHByb2Nlc3NlZENvbmZpZzsKCiAgICB0cnkgewogICAgICBwcm9jZXNzZWRDb25maWcgPSBhd2FpdCB0aGlzLnByZWNvbmZpZyhjb25maWcpOwogICAgfSBjYXRjaCAoZSkgewogICAgICByZXR1cm4gdGhpcy5lbWl0KCdlcnJvcicsIGUpOwogICAgfQoKICAgIHRoaXMuaW5pdGlhbENvbmZpZyA9IE9iamVjdC5mcmVlemUoT2JqZWN0LmFzc2lnbih7fSwgY29uZmlnLCBwcm9jZXNzZWRDb25maWcpKTsKICAgIHRoaXMuZW1pdCgnbG9hZCcsIHsKICAgICAgY29uZmlnOiB0aGlzLmluaXRpYWxDb25maWcKICAgIH0pOwogIH0KCiAgc3RhcnQoKSB7CiAgICB0aGlzLnN0b3BSZXF1ZXN0ZWQgPSBmYWxzZTsKICAgIHRoaXMuZW1pdCgnc3RhcnQnLCB7CiAgICAgIGNvbmZpZzogdGhpcy5pbml0aWFsQ29uZmlnCiAgICB9KTsKICAgIHRoaXMuZXhlY3V0ZVBpcGVsaW5lKHRoaXMuaW5pdGlhbENvbmZpZyk7CiAgfQoKICB0YWtlKG4pIHsKICAgIHRoaXMubGltaXQgPSBuOwogIH0KCiAgc3RvcCgpIHsKICAgIHRoaXMuZW1pdCgnc3RvcFJlcXVlc3RlZCcsIHRoaXMpOwogICAgdGhpcy5zdG9wUmVxdWVzdGVkID0gdHJ1ZTsKCiAgICBpZiAodGhpcy5waXBlbGluZSkgewogICAgICB0aGlzLnBpcGVsaW5lLmRlc3Ryb3koKTsKICAgIH0KICB9CgogIGxvb3AoY3VycmVudENvbmZpZykgewogICAgY29uc3Qgc2xlZXBJbnRlcnZhbCA9IHRoaXMuZ2V0VGhyb3R0bGUoY3VycmVudENvbmZpZyk7CgogICAgaWYgKE51bWJlci5pc0Zpbml0ZShzbGVlcEludGVydmFsKSAmJiBzbGVlcEludGVydmFsID49IDAgJiYgIXRoaXMuc3RvcFJlcXVlc3RlZCkgewogICAgICBjb25zb2xlLmxvZygncXVldWluZyBuZXh0IHBpcGVsaW5lIGV4ZWN1dGlvbicsIG5ldyBEYXRlKCkpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGUKCiAgICAgIHNldFRpbWVvdXQodGhpcy5leGVjdXRlUGlwZWxpbmUuYmluZCh0aGlzLCBjdXJyZW50Q29uZmlnKSwgc2xlZXBJbnRlcnZhbCk7CiAgICB9CiAgfQoKICBnZXRQaXBlbGluZUFycmF5KGNvbmZpZykgewogICAgY29uc3QgdHJhbnNmb3JtcyA9IHRoaXMuZm5TcGVjcy5tYXAob2JqID0+IHsKICAgICAgaWYgKG9iai50cmFuc2Zvcm0pIHsKICAgICAgICByZXR1cm4gdGhpcy5fbWFrZVRyYW5zZm9ybVN0cmVhbShvYmosIGNvbmZpZyk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzLl9tYWtlVGFwU3RyZWFtKG9iaiwgY29uZmlnKTsKICAgIH0sIHRoaXMpOwogICAgcmV0dXJuIFt0aGlzLl9tYWtlU291cmNlU3RyZWFtKHRoaXMuc291cmNlU3BlYywgY29uZmlnKSwgLi4udHJhbnNmb3Jtc107CiAgfQoKICBnZXREZXN0aW5hdGlvbihjb25maWcpIHsKICAgIGlmICh0aGlzLmRlc3RpbmF0aW9uU3BlYy5idWZmZXJlZCkgewogICAgICByZXR1cm4gdGhpcy5fbWFrZUJ1ZmZlcmVkRGVzdGluYXRpb25TdHJlYW0odGhpcy5kZXN0aW5hdGlvblNwZWMsIGNvbmZpZyk7CiAgICB9CgogICAgcmV0dXJuIHRoaXMuX21ha2VEZXN0aW5hdGlvblN0cmVhbSh0aGlzLmRlc3RpbmF0aW9uU3BlYywgY29uZmlnLCB0aGlzLmxpbWl0KTsKICB9CgogIGFzeW5jIGV4ZWN1dGVQaXBlbGluZShjdXJyZW50Q29uZmlnKSB7CiAgICBpZiAodGhpcy5waXBlbGluZSkgewogICAgICB0aGlzLnBpcGVsaW5lLmRlc3Ryb3koKTsKICAgIH0KCiAgICB0aGlzLl9hbGxvd1B1c2ggPSB0cnVlOwoKICAgIGlmICh0aGlzLnN0b3BSZXF1ZXN0ZWQpIHsKICAgICAgY29uc29sZS53YXJuKCdub3QgZXhlY3V0aW5nIGR1ZSB0byBgc3RvcGAgcmVxdWVzdCcpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGUKCiAgICAgIHJldHVybjsKICAgIH0KCiAgICBsZXQgcHJvY2Vzc2VkQ29uZmlnOwoKICAgIHRyeSB7CiAgICAgIHByb2Nlc3NlZENvbmZpZyA9IGF3YWl0IHRoaXMuY29tcHV0ZUNvbmZpZyh0aGlzLmluaXRpYWxDb25maWcsIGN1cnJlbnRDb25maWcpOwogICAgfSBjYXRjaCAoZSkgewogICAgICByZXR1cm4gdGhpcy5lbWl0KCdlcnJvcicsIGUpOwogICAgfQoKICAgIHRoaXMuZW1pdCgnY29uZmlnQ29tcHV0ZWQnLCBwcm9jZXNzZWRDb25maWcpOwoKICAgIHRoaXMuX3N0YXJ0UGlwZWxpbmUocHJvY2Vzc2VkQ29uZmlnKTsKICB9CgogIF9zdGFydFBpcGVsaW5lKGN1cnJlbnRDb25maWcpIHsKICAgIHRoaXMucGlwZWxpbmUgPSBwdW1waWZ5Lm9iaigpOwogICAgZW9zKHRoaXMucGlwZWxpbmUsIGVyciA9PiB7CiAgICAgIHRoaXMuX2FsbG93UHVzaCA9IGZhbHNlOwoKICAgICAgaWYgKGVycikgewogICAgICAgIHRoaXMuZW1pdCgnZXJyb3InLCBlcnIsIGN1cnJlbnRDb25maWcpOwogICAgICB9CgogICAgICB0aGlzLmVtaXQoJ2VuZCcsIGVycik7CiAgICAgIHRoaXMubG9vcChjdXJyZW50Q29uZmlnKTsKICAgIH0pOwogICAgdGhpcy5waXBlbGluZS5zZXRQaXBlbGluZSguLi50aGlzLmdldFBpcGVsaW5lQXJyYXkoY3VycmVudENvbmZpZyksIHRoaXMuZ2V0RGVzdGluYXRpb24oY3VycmVudENvbmZpZykpOwogIH0KCiAgX21ha2VTb3VyY2VTdHJlYW0oc3BlYywgY29uZmlnKSB7CiAgICBjb25zdCBzdHJlYW0gPSBmcm9tLm9iaih7CiAgICAgIGhpZ2hXYXRlck1hcms6IHRoaXMuX2h3bQogICAgfSwgKHNpemUsIG5leHQpID0+IHsKICAgICAgY29uc3QgZG9uZSA9IGVyciA9PiBzZXRUaW1lb3V0KCgpID0+IG5leHQoZXJyID8gZW5zdXJlRXJyb3IoZXJyKSA6IG51bGwsIG51bGwpLCAwKTsKCiAgICAgIHRyeSB7CiAgICAgICAgc3BlYy5zb3VyY2UoewogICAgICAgICAgY29uZmlnLAogICAgICAgICAgcHVzaDogZGF0YSA9PiB0aGlzLl9zYWZlUHVzaChzdHJlYW0sIGRhdGEpLAogICAgICAgICAgZXJyb3I6IGRvbmUsCiAgICAgICAgICBkb25lCiAgICAgICAgfSk7CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIG5leHQoZXJyKTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gc3RyZWFtOwogIH0KCiAgX21ha2VUcmFuc2Zvcm1TdHJlYW0oc3BlYywgY29uZmlnKSB7CiAgICBjb25zdCBzdHJlYW0gPSB0aHJvdWdoLm9iaih7CiAgICAgIGhpZ2hXYXRlck1hcms6IHRoaXMuX2h3bQogICAgfSwgKGNodW5rLCBlbmMsIGNhbGxiYWNrKSA9PiB7CiAgICAgIHRyeSB7CiAgICAgICAgc3BlYy50cmFuc2Zvcm0oY2h1bmssIHsKICAgICAgICAgIGNvbmZpZywKICAgICAgICAgIHB1c2g6IGRhdGEgPT4gdGhpcy5fc2FmZVB1c2goc3RyZWFtLCBkYXRhKSwKICAgICAgICAgIGVycm9yOiBlcnIgPT4gc2V0VGltZW91dCgoKSA9PiBjYWxsYmFjayhlbnN1cmVFcnJvcihlcnIpKSwgMCksCiAgICAgICAgICBkb25lOiAoKSA9PiBzZXRUaW1lb3V0KCgpID0+IGNhbGxiYWNrKCksIDApCiAgICAgICAgfSk7CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIGNhbGxiYWNrKGVycik7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIHN0cmVhbTsKICB9CgogIF9tYWtlVGFwU3RyZWFtKHNwZWMsIGNvbmZpZykgewogICAgcmV0dXJuIHNweS5vYmooZGF0YSA9PiB7CiAgICAgIHNwZWMudGFwKGRhdGEsIHsKICAgICAgICBjb25maWcKICAgICAgfSk7CiAgICB9KTsKICB9CgogIF9tYWtlQnVmZmVyZWREZXN0aW5hdGlvblN0cmVhbShzcGVjLCBjb25maWcpIHsKICAgIHJldHVybiBjb25jYXQoZGF0YSA9PiB7CiAgICAgIHNwZWMuZGVzdGluYXRpb24oZGF0YSwgewogICAgICAgIGNvbmZpZywKICAgICAgICBkb25lOiAoKSA9PiB7fQogICAgICB9KTsKICAgIH0pOwogIH0KCiAgX21ha2VEZXN0aW5hdGlvblN0cmVhbShzcGVjLCBjb25maWcsIGxpbWl0KSB7CiAgICBsZXQgY2FsbHMgPSAwOwogICAgY29uc3Qgd3MgPSB3cml0ZXIub2JqKHsKICAgICAgaGlnaFdhdGVyTWFyazogdGhpcy5faHdtCiAgICB9LCAoZGF0YSwgZW5jLCBkb25lKSA9PiB7CiAgICAgIGNhbGxzICs9IDE7CgogICAgICBpZiAobGltaXQgPiAwICYmIGNhbGxzID4gbGltaXQpIHsKICAgICAgICB0aGlzLl9hbGxvd1B1c2ggPSBmYWxzZTsKICAgICAgICB3cy5lbmQoKTsKICAgICAgICBkb25lKG51bGwpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5lbWl0KCdkYXRhJywgZGF0YSk7CiAgICAgIHNwZWMuZGVzdGluYXRpb24oZGF0YSwgewogICAgICAgIGNvbmZpZywKICAgICAgICBkb25lLAogICAgICAgIGVycm9yOiBkb25lCiAgICAgIH0pOwogICAgfSk7CiAgICByZXR1cm4gd3M7CiAgfSAvLyBmb3JjZSB0aGUgY29uc3VtZXIncyB1c2FnZSBvZiBwaXBlbGluZS5wdXNoIHRvIGJlIGFzeW5jLAogIC8vIGFuZCBhbHNvIGNoZWNrIHdlIGhhdmUgbm90IGhpdCB0aGUgbGltaXQgaW1wb3NlZCBieSB0aGlzLnRha2UobikKICAvLyBzbyB3ZSBhdm9pZCB3cml0aW5nIHRvIGEgc3RyZWFtIHRoYXQgaXMgY2xvc2VkL2Nsb3NpbmcKCgogIF9zYWZlUHVzaChzdHJlYW0sIGRhdGEpIHsKICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5fYWxsb3dQdXNoICYmIHN0cmVhbS5wdXNoKGRhdGEpLCAwKTsKICB9Cgp9Ow=="},{"version":3,"sources":["/Users/scott.ward/Documents/GitHub/my-first-bundle/node_modules/@vizia/bundle/lib/Bundle.js"],"names":["EventEmitter","require","from","through","writer","pumpify","concat","spy","eos","ensureError","err","Error","message","module","exports","Bundle","constructor","initialConfig","fnSpecs","limit","_hwm","setThrottle","ms","getThrottle","use","obj","source","sourceSpec","transform","tap","push","destination","destinationSpec","preconfig","config","computeConfig","currentConfig","load","processedConfig","e","emit","Object","freeze","assign","start","stopRequested","executePipeline","take","n","stop","pipeline","destroy","loop","sleepInterval","Number","isFinite","console","log","Date","setTimeout","bind","getPipelineArray","transforms","map","_makeTransformStream","_makeTapStream","_makeSourceStream","getDestination","buffered","_makeBufferedDestinationStream","_makeDestinationStream","_allowPush","warn","_startPipeline","setPipeline","spec","stream","highWaterMark","size","next","done","data","_safePush","error","chunk","enc","callback","calls","ws","end"],"mappings":"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","sourcesContent":["'use strict';\n\nconst EventEmitter = require('events');\nconst from = require('from2');\nconst through = require('through2');\nconst writer = require('to2');\nconst pumpify = require('pumpify');\nconst concat = require('concat-stream');\nconst spy = require('through2-spy');\nconst eos = require('end-of-stream');\n\nfunction ensureError(err) {\n    return err instanceof Error ? err : new Error(err.message || err);\n}\n\nmodule.exports = class Bundle extends EventEmitter {\n    constructor() {\n        super();\n        this.initialConfig = {};\n        this.fnSpecs = [];\n        this.limit = -1;\n        this._hwm = 1; // highWaterMark for streams. Don't mess with it unless you know what you're doing.\n    }\n\n    setThrottle(ms) {\n        this.getThrottle = () => ms;\n    }\n\n    getThrottle() {\n        return -1;\n    }\n\n    use(obj) {\n        if (obj.source) {\n            this.sourceSpec = obj;\n        } else if (obj.transform || obj.tap) {\n            this.fnSpecs.push(obj);\n        } else if (obj.destination) {\n            this.destinationSpec = obj;\n        }\n    }\n\n    async preconfig(config) {\n        return config;\n    }\n\n    async computeConfig(initialConfig, currentConfig) {\n        return currentConfig;\n    }\n\n    async load(config) {\n        let processedConfig;\n        try {\n            processedConfig = await this.preconfig(config);\n        } catch (e) {\n            return this.emit('error', e);\n        }\n\n        this.initialConfig = Object.freeze(Object.assign({}, config, processedConfig));\n        this.emit('load', {config: this.initialConfig});\n    }\n\n    start() {\n        this.stopRequested = false;\n        this.emit('start', {config: this.initialConfig});\n        this.executePipeline(this.initialConfig);\n    }\n\n    take(n) {\n        this.limit = n;\n    }\n\n    stop() {\n        this.emit('stopRequested', this);\n        this.stopRequested = true;\n\n        if (this.pipeline) {\n            this.pipeline.destroy();\n        }\n    }\n\n    loop(currentConfig) {\n        const sleepInterval = this.getThrottle(currentConfig);\n        if (Number.isFinite(sleepInterval) && sleepInterval >= 0 && !this.stopRequested) {\n            console.log('queuing next pipeline execution', new Date()); // eslint-disable-line no-console\n            setTimeout(this.executePipeline.bind(this, currentConfig), sleepInterval);\n        }\n    }\n\n    getPipelineArray(config) {\n        const transforms = this.fnSpecs.map((obj) => {\n            if (obj.transform) {\n                return this._makeTransformStream(obj, config);\n            }\n            return this._makeTapStream(obj, config);\n        }, this);\n\n        return [\n            this._makeSourceStream(this.sourceSpec, config),\n            ...transforms\n        ];\n    }\n\n    getDestination(config) {\n        if (this.destinationSpec.buffered) {\n            return this._makeBufferedDestinationStream(this.destinationSpec, config);\n        }\n        return this._makeDestinationStream(this.destinationSpec, config, this.limit);\n    }\n\n    async executePipeline(currentConfig) {\n        if (this.pipeline) {\n            this.pipeline.destroy();\n        }\n\n        this._allowPush = true;\n\n        if (this.stopRequested) {\n            console.warn('not executing due to `stop` request'); // eslint-disable-line no-console\n            return;\n        }\n\n        let processedConfig;\n        try {\n            processedConfig = await this.computeConfig(this.initialConfig, currentConfig);\n        } catch (e) {\n            return this.emit('error', e);\n        }\n\n        this.emit('configComputed', processedConfig);\n        this._startPipeline(processedConfig);\n    }\n\n    _startPipeline(currentConfig) {\n        this.pipeline = pumpify.obj();\n\n        eos(this.pipeline, (err) => {\n            this._allowPush = false;\n            if (err) {\n                this.emit('error', err, currentConfig);\n            }\n            this.emit('end', err);\n            this.loop(currentConfig);\n        });\n\n        this.pipeline.setPipeline(...this.getPipelineArray(currentConfig), this.getDestination(currentConfig));\n    }\n\n    _makeSourceStream(spec, config) {\n        const stream = from.obj({highWaterMark: this._hwm}, (size, next) => {\n            const done = err => setTimeout(() => next(err ? ensureError(err) : null, null), 0)\n            try {\n                spec.source({\n                    config,\n                    push: data => this._safePush(stream, data),\n                    error: done,\n                    done\n                });\n            } catch (err) {\n                next(err);\n            }\n        });\n\n        return stream;\n    }\n\n    _makeTransformStream(spec, config) {\n        const stream = through.obj({highWaterMark: this._hwm}, (chunk, enc, callback) => {\n            try {\n                spec.transform(chunk, {\n                    config,\n                    push: data => this._safePush(stream, data),\n                    error: err => setTimeout(() => callback(ensureError(err)), 0),\n                    done: () => setTimeout(() => callback(), 0)\n                });\n            } catch (err) {\n                callback(err);\n            }\n        });\n\n        return stream;\n    }\n\n    _makeTapStream(spec, config) {\n        return spy.obj((data) => {\n            spec.tap(data, {config});\n        });\n    }\n\n    _makeBufferedDestinationStream(spec, config) {\n        return concat((data) => {\n            spec.destination(data, {\n                config,\n                done: () => {}\n            });\n        });\n    }\n\n    _makeDestinationStream(spec, config, limit) {\n        let calls = 0;\n\n        const ws = writer.obj({highWaterMark: this._hwm}, (data, enc, done) => {\n            calls += 1;\n\n            if (limit > 0 && calls > limit) {\n                this._allowPush = false;\n                ws.end();\n                done(null);\n                return;\n            }\n\n            this.emit('data', data);\n\n            spec.destination(data, {\n                config,\n                done,\n                error: done\n            });\n        });\n\n        return ws;\n    }\n\n    // force the consumer's usage of pipeline.push to be async,\n    // and also check we have not hit the limit imposed by this.take(n)\n    // so we avoid writing to a stream that is closed/closing\n    _safePush(stream, data) {\n        setTimeout(() => this._allowPush && stream.push(data), 0);\n    }\n};\n"]}]}